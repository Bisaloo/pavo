<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>pavo • pavo</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="pavo">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pavo</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/pavo.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/spectraldesc.html">Spectral shape descriptors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>pavo</h1>
                        <h4 class="author">Rafael Maia, Thomas White, Hugo Gruson, Pierre-Paul Bitton, Chad Eliason</h4>
            
            <h4 class="date">2018-09-08</h4>
      
      
      <div class="hidden name"><code>pavo.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><code>pavo</code> is an <code>R</code> package developed with the goal of establishing a flexible and integrated workflow for working with spectral and spatial color data. It includes functions that take advantage of new data classes to work seamlessly from importing raw spectra and images, to visualization and analysis. It provides flexible ways to input spectral data from a variety of equipment manufacturers, process these data, extract variables, and produce publication-quality figures.</p>
<p><code>pavo</code> was written with the following workflow in mind:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Organize</strong> data by importing and processing spectral and image data (e.g., to remove noise, negative values, smooth curves, etc.).</li>
<li>
<strong>Analyze</strong> the resulting files, using spectral analyses of shape (hue, saturation, brightness), visual models based on perceptual data, and/or spatial adjacency and boundary strength analyses.</li>
<li>
<strong>Visualize</strong> the output, with multiple options provided for exploration and analysis.</li>
</ol>
<p>Below we will show the main functions in the package in example workflows. The development version of <code>pavo</code> can be found on <a href="https://github.com/rmaia/pavo">github</a>.</p>
<div class="figure">
<img src="../../../../../../Dropbox%20(Sydney%20Uni)/notes/research/projects/pavo/vignettes/fig/workflow.png" alt="_A non-exhaustive overview of the colour-pattern analysis workflow in pavo, as of version 2.0, displaying some key functions at each stage._" width="70%"><p class="caption">
<em>A non-exhaustive overview of the colour-pattern analysis workflow in pavo, as of version 2.0, displaying some key functions at each stage.</em>
</p>
</div>
<p>Let’s begin by loading the package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Load the package, and set a global random-number seed for the reproducible generation of fake data later on.</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(pavo)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">set.seed</span>(<span class="dv">1612217</span>)</a></code></pre></div>
</div>
<div id="organizing-spectral-data" class="section level1">
<h1 class="hasAnchor">
<a href="#organizing-spectral-data" class="anchor"></a>Organizing Spectral Data</h1>
<div id="spectral-dataset-description" class="section level2">
<h2 class="hasAnchor">
<a href="#spectral-dataset-description" class="anchor"></a>Spectral Dataset Description</h2>
<p>The spectral data used in this example are available from <a href="http://github.com">github</a> by clicking <a href="https://github.com/rmaia/pavo/blob/master/vignette_data/vignette_data.zip">here</a>. You can download and extract it to follow the vignette.</p>
<p>The data consist of reflectance spectra, obtained using Avantes equipment and software, from seven bird species: Northern Cardinal <em>Cardinalis cardinalis</em>, Wattled Jacana <em>Jacana jacana</em>, Baltimore Oriole <em>Icterus galbula</em>, Peach-fronted Parakeet <em>Aratinga aurea</em>, American Robin <em>Turdus migratorius</em>, and Sayaca Tanager <em>Thraupis sayaca</em>. Several individuals were measured (sample size varies by species), and 3 spectra were collected from each individual. However, the number of individuals measured per species is uneven and the data have additional peculiarities that should emphasize the flexibility <code>pavo</code> offers, as we’ll see below.</p>
<p>In addition, <code>pavo</code> includes three datasets that can be called with the <code>data</code> function. <code>data(teal)</code>, <code>data(sicalis)</code>, and <code>data(flowers)</code> will all be used in this vignette. See help for more information <code>help(package = "pavo")</code>.</p>
</div>
<div id="importing" class="section level2">
<h2 class="hasAnchor">
<a href="#importing" class="anchor"></a>Importing</h2>
<p>The first thing we need to do is import the spectral data into R using the function <code><a href="../reference/getspec.html">getspec()</a></code>. Since the spectra were obtained using Avantes software, we will need to specify that the files have the <code>.ttt</code> extension. Further, the data is organized in subdirectories for each species. <code>getspec</code> does recursive sampling, and may include the names of the subdirectories in the spectra name if desired. <code>getspec</code> also uses parallel processing when the argument <code>cores</code> is set to a number greater than <code>1</code> (currently available only on Linux and Mac). A final issue with the data is that it was collected using a computer with international numbering input, which means it uses commas instead of periods as a decimal separator. We can specify that in the function call.</p>
<p><code>getspec</code> also allows the use of <strong>parallel processing</strong> to speed up importing large datasets. This is controlled by the <code>cores</code> argument. If set to 1, single threading will be used <strong>(parallel processing not available in Windows, only Linux/Unix and Mac)</strong>.</p>
<p>The files were downloaded and placed in a directory called <code>/pavo/vignette_data</code>. By default, <code>getspec</code> will search for files in the current folder, but a different one can be specified:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#specs &lt;- getspec("~/pavo/vignette_data/", ext = "ttt", decimal = ",", subdir = TRUE, subdir.names = FALSE)</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co"># 213  files found; importing spectra</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># |================================================================================| 100%, ETA 00:00</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">specs[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a></code></pre></div>
<pre><code>##     wl cardinal.0001 cardinal.0002 cardinal.0003
## 1  300        5.7453        8.0612        8.0723
## 2  301        6.0181        8.3926        8.8669
## 3  302        5.9820        8.8280        9.0680
## 4  303        6.2916        8.7621        8.7877
## 5  304        6.6277        8.6819        9.3450
## 6  305        6.3347        9.6016        9.4834
## 7  306        6.3189        9.5712        9.3533
## 8  307        6.7951        9.4650        9.9492
## 9  308        7.0758        9.4677        9.8587
## 10 309        7.2126       10.6172       10.5396</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">dim</span>(specs) <span class="co"># the data set has 213 spectra, from 300 to 700 nm, plus a 'wl' column</span></a></code></pre></div>
<pre><code>## [1] 401 214</code></pre>
<p>When <code>pavo</code> imports spectra, it creates an object of class <code>rspec</code>, which inherits attributes from the <code>data.frame</code> class:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/as.rspec.html">is.rspec</a></span>(specs)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If you already have multiple spectra in a single data frame that you’d like to use with <code>pavo</code> functions, you can use the command <code>as.rspec</code> to convert it to an rspec object. The function will attempt to identify the wavelength variable or you can specify the column containing wavelengths with the <code>whichwl</code> argument. The default way that <code>as.rspec</code> handles reflectance data is to interpolate the data in 1-nm bins, as is commonly done for spectral analyses. However, this can be turned off by using: <code>interp = FALSE</code>. As an example, we will create some fake reflectance data, name the column containing wavelengths (in 0.5-nm bins) <em>wavelength</em> rather than <em>wl</em> (required for <code>pavo</code> functions to work) and also put the column containing wavelengths third rather than first.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Create some fake reflectance data with wavelength column arbitrarily titled</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># and not first in the data frame:</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">fakedat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">refl1 =</span> <span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">801</span>),</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">refl2 =</span> <span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">801</span>),</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">wavelength =</span> <span class="kw">seq</span>(<span class="dv">300</span>, <span class="dv">700</span>, <span class="dt">by =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw">head</span>(fakedat)</a></code></pre></div>
<pre><code>##          refl1      refl2 wavelength
## 1 -0.032893386  0.5059612      300.0
## 2 -0.478552738 -1.1526035      300.5
## 3 -0.190687886 -1.0708952      301.0
## 4 -0.008977959 -1.9871907      301.5
## 5 -0.443133039 -0.3910143      302.0
## 6  0.032110206 -0.5403221      302.5</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/as.rspec.html">is.rspec</a></span>(fakedat)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">fakedat.new &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedat)</a></code></pre></div>
<pre><code>## wavelengths found in column 3</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../reference/as.rspec.html">is.rspec</a></span>(fakedat.new)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">head</span>(fakedat.new)</a></code></pre></div>
<pre><code>##    wl       refl1       refl2
## 1 300 -0.03289339  0.50596119
## 2 301 -0.19068789 -1.07089518
## 3 302 -0.44313304 -0.39101435
## 4 303 -0.52064707  0.84403232
## 5 304  1.42813472  0.07150436
## 6 305 -0.19044804 -0.84504226</code></pre>
<p>As can be seen, <code>as.rspec</code> renames the column containing wavelengths, sets it as the first column, interpolates the data in 1-nm bins and converts the data to an <code>rspec</code> object. Note that the same output is returned with specifying <code>whichwl = 3</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">head</span>(<span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedat, <span class="dt">whichwl =</span> <span class="dv">3</span>))</a></code></pre></div>
<pre><code>##    wl       refl1       refl2
## 1 300 -0.03289339  0.50596119
## 2 301 -0.19068789 -1.07089518
## 3 302 -0.44313304 -0.39101435
## 4 303 -0.52064707  0.84403232
## 5 304  1.42813472  0.07150436
## 6 305 -0.19044804 -0.84504226</code></pre>
<p>Finally, the <code>lim</code> argument allows you to specify the range of wavelengths contained in the input dataset. This is useful either in the case that the dataset doesn’t contain this information (and hence you cannot specify the column with <code>whichwl</code> or automatically find the column with <code>as.rspec</code>). Additionally, it may be useful to focus on a subset of wavelength. In our example, the wavelengths ranged from 300 to 700 nm, however you could also specify a restricted range of wavelengths with <code>lim</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">fakedat.new2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedat, <span class="dt">lim =</span> <span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">500</span>))</a></code></pre></div>
<pre><code>## wavelengths found in column 3</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">plot</span>(fakedat.new2[, <span class="dv">2</span>] <span class="op">~</span><span class="st"> </span>fakedat.new2[, <span class="dv">1</span>], <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">xlab =</span> <span class="st">"wl"</span>)</a></code></pre></div>
<p><img src="pavo_files/figure-html/unnamed-chunk-9-1.png" width="384" style="display: block; margin: auto;"></p>
<p>We want to stress that it is important to check the actual wavelengths contained in the data before setting this argument (<code>as.rspec</code> will warn you when wavelengths in the data are not present in the range specified with <code>lim</code>), otherwise <code>as.rspec</code> will assume that wavelengths exist when in fact they may not. For example, if we set <code>lim = c(300, 1000)</code> and plot the results, the reflectance values between 700 and 1000 nm are set to be equal since there is no information at these wavelengths in the original dataset:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">fakedat.new2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedat, <span class="dt">lim =</span> <span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">1000</span>))</a></code></pre></div>
<pre><code>## wavelengths found in column 3</code></pre>
<pre><code>## Warning in as.rspec(fakedat, lim = c(300, 1000)): Specified wavelength
## limits outside of actual data. Check 'lim' argument.</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">plot</span>(fakedat.new2[, <span class="dv">2</span>] <span class="op">~</span><span class="st"> </span>fakedat.new2[, <span class="dv">1</span>], <span class="dt">type =</span> <span class="st">"l"</span>)</a></code></pre></div>
<p><img src="pavo_files/figure-html/unnamed-chunk-10-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="subsetting-and-merging-spectral-data" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting-and-merging-spectral-data" class="anchor"></a>Subsetting and Merging Spectral Data</h2>
<p>Once an <code>rspec</code> object has been created, either by importing raw spectral data or converting a dataset with the <code>as.rspec</code> function, you can subset the spectra based on their names using a modified version of <code>R</code>’s built-in <code>subset</code> function. For example, the following code illustrates how to create an <code>rspec</code> object containing only tanagers:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">specs.tanager1 &lt;-<span class="st"> </span><span class="kw">subset</span>(specs, <span class="st">"tanager"</span>)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="kw">head</span>(specs.tanager1)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>##    wl tanager.0001 tanager.0002 tanager.0003 tanager.0004
## 1 300      10.0618      10.6744      10.1499      13.7473
## 2 301      11.1472      10.8054       9.8003      14.3102
## 3 302      10.7819      10.6134       9.5607      14.4463
## 4 303      11.0210      11.2037      10.4107      15.5533
## 5 304      10.2177      11.2120       9.9452      14.3841
## 6 305      11.5664      11.6135      10.8659      15.6445</code></pre>
<p>The <code>subset</code> function here is using partial matching to find all spectra with the string “tanager” in their name. To fully benefit from this flexible subsetting functionality, it is important that you follow a consistent file naming scheme. For example, <code>tanager.14423.belly.001.ttt</code> would indicate the species (tanager), individual ID (14423), body patch (belly) and measurement number (001). Additionally, we suggest that labels used should have the same number of characters, which simplifies character string manipulation and subsetting based on partial matching.</p>
<p>If you prefer not to use partial matching, <code>subset</code> will also work if you provide a logical condition, similar to the default <code>subset</code> behavior in <code>R</code>. For example:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># extract first component of filenames containing species names</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">spp &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, <span class="kw">strsplit</span>(<span class="kw">names</span>(specs), <span class="st">"</span><span class="ch">\\</span><span class="st">."</span>))[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co"># subset</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">specs.tanager2 &lt;-<span class="st"> </span><span class="kw">subset</span>(specs, <span class="dt">subset =</span> spp <span class="op">==</span><span class="st"> "tanager"</span>)</a>
<a class="sourceLine" id="cb30-6" data-line-number="6"></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co"># compare subsetting methods</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="kw">all.equal</span>(specs.tanager1, specs.tanager2)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Note that <code>subset</code> will also work with visual model (class <code>vismodel</code>) and colspace (class <code>colspace</code>) objects, as described below.</p>
<p>Another useful function is <code>merge</code>. Let’s say that you have subsetted spectra for tanagers and parakeets, and you would like to re-combine them for an analysis. The following lines of code show how to do this:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">specs.tanager &lt;-<span class="st"> </span><span class="kw">subset</span>(specs, <span class="st">"tanager"</span>)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">specs.parakeet &lt;-<span class="st"> </span><span class="kw">subset</span>(specs, <span class="st">"parakeet"</span>)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">specs.new &lt;-<span class="st"> </span><span class="kw">merge</span>(specs.tanager, specs.parakeet)</a></code></pre></div>
<p>Note that this re-combined file (<code>specs.new</code>) has only a single <code>wl</code> column with the merged spectra as columns. Keep in mind that the order of objects in <code>merge</code> will determine the order of columns in the final merged object (i.e. tanagers will be before parakeets).</p>
</div>
</div>
<div id="processing-spectral-data" class="section level1">
<h1 class="hasAnchor">
<a href="#processing-spectral-data" class="anchor"></a>Processing Spectral Data</h1>
<div id="averaging-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#averaging-spectra" class="anchor"></a>Averaging Spectra</h2>
<p>As previously described, our data (contained in the <code>specs</code> object) constitutes of multiple individuals, and each was measured three times, as is common to avoid measurement bias. A good way to visualize the repeatability of our measurements is to plot the spectra of each individual separately. The function <code>explorespec</code> provides an easy way of doing so. You may specify the number of spectra to be plotted in the same panel using the argument <code>specreps</code>, and the function will adjust the number of panels per page accordingly. We will exemplify this function using only the 12 cardinal individuals measured:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co"># 36 spectra plus the first (wl) column</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="kw"><a href="../reference/explorespec.html">explorespec</a></span>(specs[, <span class="dv">1</span><span class="op">:</span><span class="dv">37</span>], <span class="dt">by =</span> <span class="dv">3</span>, <span class="dt">lwd =</span> <span class="dv">2</span>) </a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/explorespecfig-1.png" alt="_Result from `explorespec`, showing the three measurements for each individual cardinal in separate panels_" width="576"><p class="caption">
<em>Result from <code>explorespec</code>, showing the three measurements for each individual cardinal in separate panels</em>
</p>
</div>
<p>So our first step would be to take the average of each of these three measurements to obtain average individual spectra to be used in further analyses. This is easily accomplished using the <code>aggspec</code> function. The <code>by</code> argument can be either a number (specifying how many specs should be averaged for each new sample) or a vector specifying the identities of the spectra to be combined (see below):</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">mspecs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aggspec.html">aggspec</a></span>(specs, <span class="dt">by =</span> <span class="dv">3</span>, <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">mspecs[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a></code></pre></div>
<pre><code>##    wl cardinal cardinal.1 cardinal.2
## 1 300 7.292933   5.676700   6.387233
## 2 301 7.759200   5.806700   6.698200
## 3 302 7.959333   5.858467   6.910500
## 4 303 7.947133   6.130267   7.357567
## 5 304 8.218200   6.127933   7.195267</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">dim</span>(mspecs) <span class="co"># data now has 71 spectra, one for each individual, and the 'wl' column</span></a></code></pre></div>
<pre><code>## [1] 401  72</code></pre>
<p>Now we’ll use the <code>aggspec</code> function again, but this time to take the average spectrum for each species. However, each species has a different number of samples, so we can’t use the <code>by</code> argument as before. Instead we will use regular expressions to create a species name vector by removing the numbers that identify individual spectra:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="co"># create a vector with species identity names</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2">spp &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">'</span><span class="ch">\\</span><span class="st">.[0-9].*$'</span>, <span class="st">''</span>, <span class="kw">names</span>(mspecs))[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="kw">table</span>(spp)</a></code></pre></div>
<pre><code>## spp
## cardinal   jacana   oriole parakeet    robin  tanager 
##       12        9        9       13       10       18</code></pre>
<p>Instead, we are going to use the <code>spp</code> vector we created to tell the <code>aggspec</code> function how to average the spectra in <code>mspec</code>:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">sppspec &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aggspec.html">aggspec</a></span>(mspecs, <span class="dt">by =</span> spp, <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="kw">round</span>(sppspec[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ], <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##    wl cardinal jacana oriole parakeet robin tanager
## 1 300     7.05   7.33   3.89     7.63  3.98    9.02
## 2 301     7.25   7.35   3.91     7.75  3.91    9.53
## 3 302     7.44   7.45   4.13     7.89  4.19    9.41
## 4 303     7.82   8.09   4.39     8.49  4.51   10.20
## 5 304     7.84   7.71   4.18     8.66  4.07    9.68</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw"><a href="../reference/explorespec.html">explorespec</a></span>(sppspec, <span class="dt">by =</span> <span class="dv">6</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo_files/figure-html/exploresppmeans-1.png" alt="_Result from `explorespec` for species means_" width="480"><p class="caption">
<em>Result from <code>explorespec</code> for species means</em>
</p>
</div>
</div>
<div id="normalizing-and-smoothing-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#normalizing-and-smoothing-spectra" class="anchor"></a>Normalizing and Smoothing Spectra</h2>
<p>Data obtained from spectrometers often requires further processing before analysis and/or publication. For example, electrical noise can produce unwanted “spikes”" in reflectance curves. The <code>pavo</code> function <code>procspec</code> can handle a variety of processing techniques. For example, the reflectance curve from the parakeet is noisy in the short (300-400 nm) and long (650-700 nm) wavelength ranges (see Figure below, black line). To eliminate this noise, we will use local regression smoothing implemented by the <code>loess.smooth</code> function in <code>R</code>, wrapped in the <code>opt="smooth"</code> argument of <code>procspec</code>.</p>
<p>But first, let’s use the <code>plotsmooth</code> function to determine a suitable smoothing parameter (<code>span</code>). This function allows you to set a minimum and maximum smoothing parameter to try and plots the resulting curves against the unsmoothed (raw) data in a convenient multipanel figure.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="../reference/plotsmooth.html">plotsmooth</a></span>(sppspec, <span class="dt">minsmooth =</span> <span class="fl">0.05</span>, <span class="dt">maxsmooth =</span> <span class="fl">0.5</span>, <span class="dt">curves =</span> <span class="dv">4</span>, <span class="dt">ask =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="pavo_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;"></p>
<p>From the resulting plot, we can see that <code>span = 0.2</code> is the minimum amount of smoothing to remove spectral noise while preserving the original spectral shape. Based on this value, we will now use the <code>opt</code> argument in <code>procspec</code> to smooth data for further plotting and analysis.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">spec.sm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(sppspec, <span class="dt">opt =</span> <span class="st">"smooth"</span>, <span class="dt">span =</span> <span class="fl">0.2</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## smoothing spectra with a span of 0.2</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">plot</span>(sppspec[, <span class="dv">5</span>] <span class="op">~</span><span class="st"> </span>sppspec[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">  <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">lwd =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="st">"grey"</span>,</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">  <span class="dt">xlab =</span> <span class="st">"Wavelength (nm)"</span>, <span class="dt">ylab =</span> <span class="st">"Reflectance (%)"</span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb46-5" data-line-number="5"><span class="kw">lines</span>(spec.sm[, <span class="dv">5</span>] <span class="op">~</span><span class="st"> </span>sppspec[, <span class="dv">1</span>], <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-17-1.png" alt="_Result for raw (grey line) and smoothed (red line) reflectance data for the parakeet_" width="480"><p class="caption">
<em>Result for raw (grey line) and smoothed (red line) reflectance data for the parakeet</em>
</p>
</div>
<p>We can also try different normalizations. Options include subtracting the minimum reflectance of a spectrum at all wavelengths (effectively making the minimum reflectance equal to zero, <code>opt = "min"</code>, left panel, below) and making the reflectance at all wavelength proportional to the maximum reflectance (i.e. setting maximum reflectance to 1; <code>opt = "max"</code>, center panel, below). Note that the user can specify multiple processing options that will be applied sequentially to the spectral data by <code>procspec</code> (right panel, below).</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="co"># Run some different normalizations</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2">specs.max &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(sppspec, <span class="dt">opt =</span> <span class="st">"max"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a maximum value of 1</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">specs.min &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(sppspec, <span class="dt">opt =</span> <span class="st">"min"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a minimum value of zero</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">specs.str &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(sppspec, <span class="dt">opt =</span> <span class="kw">c</span>(<span class="st">"min"</span>, <span class="st">"max"</span>)) <span class="co"># multiple options</span></a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a minimum value of zero
## Scaling spectra to a maximum value of 1</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="co"># Plot results</span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb53-3" data-line-number="3"></a>
<a class="sourceLine" id="cb53-4" data-line-number="4"><span class="kw">plot</span>(specs.min[, <span class="dv">5</span>] <span class="op">~</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>), <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">type =</span> <span class="st">"l"</span>)</a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb53-6" data-line-number="6"></a>
<a class="sourceLine" id="cb53-7" data-line-number="7"><span class="kw">plot</span>(specs.max[, <span class="dv">5</span>] <span class="op">~</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">type =</span> <span class="st">"l"</span>)</a>
<a class="sourceLine" id="cb53-8" data-line-number="8"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb53-9" data-line-number="9"></a>
<a class="sourceLine" id="cb53-10" data-line-number="10"><span class="kw">plot</span>(specs.str[, <span class="dv">5</span>] <span class="op">~</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>), <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb53-11" data-line-number="11"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb53-12" data-line-number="12"></a>
<a class="sourceLine" id="cb53-13" data-line-number="13"><span class="kw">mtext</span>(<span class="st">"Wavelength (nm)"</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb53-14" data-line-number="14"><span class="kw">mtext</span>(<span class="st">"Reflectance (%)"</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-19-1.png" alt="_Results for min (left), max (center), and both normalizations (right)_" width="672"><p class="caption">
<em>Results for min (left), max (center), and both normalizations (right)</em>
</p>
</div>
</div>
<div id="binning-and-pca-analysis-of-spectral-shape" class="section level2">
<h2 class="hasAnchor">
<a href="#binning-and-pca-analysis-of-spectral-shape" class="anchor"></a>Binning and PCA Analysis of Spectral Shape</h2>
<p>Another intended usage of <code>procspec</code> is preparation of spectral data for variable reduction (for example, using Principal Component Analysis, or PCA). Following Cuthill et al. (1999), we can use <code>opt = 'center'</code> to center spectra to have a mean reflectance of zero (thus removing brightness as a dominant variable in the PCA) and then bin the spectra into user-defined bins (using the <code>opt = 'bin'</code> argument) to obtain a dataframe suitable for the PCA.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="co"># pca analysis</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2">spec.bin &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(sppspec, <span class="dt">opt =</span> <span class="kw">c</span>(<span class="st">"bin"</span>, <span class="st">"center"</span>))</a></code></pre></div>
<pre><code>## processing options applied:
## Centering spectra to a mean of zero
## binned spectra to 21-nm intervals</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">head</span>(spec.bin)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">spec.bin &lt;-<span class="st"> </span><span class="kw">t</span>(spec.bin) <span class="co"># transpose so wavelength are variables for the PCA</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="kw">colnames</span>(spec.bin) &lt;-<span class="st"> </span>spec.bin[<span class="dv">1</span>, ] <span class="co"># names variables as wavelength bins</span></a>
<a class="sourceLine" id="cb56-4" data-line-number="4">spec.bin &lt;-<span class="st"> </span>spec.bin[<span class="op">-</span><span class="dv">1</span>, ] <span class="co"># remove 'wl' column</span></a>
<a class="sourceLine" id="cb56-5" data-line-number="5">pca1 &lt;-<span class="st"> </span><span class="kw">prcomp</span>(spec.bin, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">summary</span>(pca1)</a></code></pre></div>
<pre><code>## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5       PC6
## Standard deviation     3.6041 1.9853 1.5800 0.66314 0.36427 2.705e-16
## Proportion of Variance 0.6495 0.1971 0.1248 0.02199 0.00663 0.000e+00
## Cumulative Proportion  0.6495 0.8466 0.9714 0.99337 1.00000 1.000e+00</code></pre>
<p>As can be seen by the summary, PC1 explains approximately 64% of the variation in spectral shape and describes the relative amount of long wavelengths reflected. The flexibility of <code>R</code> and <code>pavo</code>’s plotting capabilities allows you to sort spectra by another variable (e.g., PC1 loading) and then plot in a stacked format using the <code>plot</code> function.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="co"># Generate colors from spectra</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2">colr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(sppspec)</a>
<a class="sourceLine" id="cb59-3" data-line-number="3">wls &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">colnames</span>(spec.bin))</a>
<a class="sourceLine" id="cb59-4" data-line-number="4"></a>
<a class="sourceLine" id="cb59-5" data-line-number="5"><span class="co"># Rank specs by PC1</span></a>
<a class="sourceLine" id="cb59-6" data-line-number="6">sel &lt;-<span class="st"> </span><span class="kw">rank</span>(pca1<span class="op">$</span>x[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb59-7" data-line-number="7">sel &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="kw">names</span>(<span class="kw">sort</span>(sel)), <span class="kw">names</span>(sppspec))</a>
<a class="sourceLine" id="cb59-8" data-line-number="8"></a>
<a class="sourceLine" id="cb59-9" data-line-number="9"><span class="co"># Plot results</span></a>
<a class="sourceLine" id="cb59-10" data-line-number="10"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb59-11" data-line-number="11"><span class="kw">plot</span>(pca1<span class="op">$</span>r[, <span class="dv">1</span>] <span class="op">~</span><span class="st"> </span>wls, <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">ylab =</span> <span class="st">"PC1 loading"</span>)</a>
<a class="sourceLine" id="cb59-12" data-line-number="12"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb59-13" data-line-number="13"><span class="kw">plot</span>(sppspec, <span class="dt">select =</span> sel, <span class="dt">type =</span> <span class="st">"s"</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(sppspec))</a>
<a class="sourceLine" id="cb59-14" data-line-number="14"><span class="kw">mtext</span>(<span class="st">"Wavelength (nm)"</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-22-1.png" alt="_Plot of PC1 loading versus wavelength (left) and species mean spectra sorted vertically from lowest to highest PC1 value (right; values on right hand axis are column identities)._" width="672"><p class="caption">
<em>Plot of PC1 loading versus wavelength (left) and species mean spectra sorted vertically from lowest to highest PC1 value (right; values on right hand axis are column identities).</em>
</p>
</div>
</div>
<div id="dealing-with-negative-values-in-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#dealing-with-negative-values-in-spectra" class="anchor"></a>Dealing With Negative Values in Spectra</h2>
<p>Negative values in spectra are unwanted, as they are uninterpretable (how can there be less than zero light reflected by a surface?) and can affect estimates of color variables. Nonetheless, certain spectrometer manufacturers allow negative values to be saved. To handle negative values, the <code>procspec</code> function has an argument called <code>fixneg</code>. The two options available are (1) adding the absolute value of the most negative value to the whole spectrum with <code>addmin</code>, and (2) changing all negative values to zero with <code>zero</code>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="co"># Create a duplicate spectrum and add some negative values</span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2">refl &lt;-<span class="st"> </span>sppspec[, <span class="dv">7</span>] <span class="op">-</span><span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3">testspecs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>), refl))</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="co"># Apply two different processing options</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2">testspecs.fix1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(testspecs, <span class="dt">fixneg =</span> <span class="st">"addmin"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Negative value correction: added min to all reflectance</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">testspecs.fix2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(testspecs, <span class="dt">fixneg =</span> <span class="st">"zero"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Negative value correction: converted negative values to zero</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="co"># Plot it</span></a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb66-3" data-line-number="3"><span class="kw">layout</span>(<span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)), <span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb66-4" data-line-number="4"></a>
<a class="sourceLine" id="cb66-5" data-line-number="5"><span class="kw">plot</span>(testspecs, <span class="dt">select =</span> <span class="dv">2</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb66-6" data-line-number="6"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb66-7" data-line-number="7"></a>
<a class="sourceLine" id="cb66-8" data-line-number="8"><span class="kw">plot</span>(testspecs.fix1, <span class="dt">select =</span> <span class="dv">2</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb66-9" data-line-number="9"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb66-10" data-line-number="10"></a>
<a class="sourceLine" id="cb66-11" data-line-number="11"><span class="kw">plot</span>(testspecs.fix2, <span class="dt">select =</span> <span class="dv">2</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb66-12" data-line-number="12"><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb66-13" data-line-number="13"></a>
<a class="sourceLine" id="cb66-14" data-line-number="14"><span class="kw">mtext</span>(<span class="st">"Wavelength (nm)"</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb66-15" data-line-number="15"><span class="kw">mtext</span>(<span class="st">"Reflectance (%)"</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-24-1.png" alt="_Plots showing original reflectance curve including negative values (left) and two processed curves using `fixneg = addmin` (top right) and `fixneg = zero` (bottom right)._" width="480"><p class="caption">
<em>Plots showing original reflectance curve including negative values (left) and two processed curves using <code>fixneg = addmin</code> (top right) and <code>fixneg = zero</code> (bottom right).</em>
</p>
</div>
<p>These manipultions may have different effects on the final spectra, which the user should keep in mind and use according to the final goal of the analysis. For example, by adding the minimum reflectance to all other wavelength, the shape of the curve is preserved, but the maximum reflectance is much higher. On the other hand, substituting negative values with zero preserves absolute reflectance values, but may cause the spectral shape to be lost. The “best” transformation will depend on the severity of the problem of negative values and the goal of the analysis (e.g. will reflectance intensity be used? What is more important, to preserve reflectance values or the total shape of the curve?). Which correction to use would also depend on the source of the negative values. If they are thought to originate from improper calibration of the spectrophotometer, <code>fixneg = addmin</code> would be appropriate. However, if they are thought to originate from electric noise, <code>fixneg = zero</code> would be more appropriate.</p>
</div>
</div>
<div id="visualizing-spectral-data" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-spectral-data" class="anchor"></a>Visualizing Spectral Data</h1>
<p><code>pavo</code> offers three main plotting functions. The main one is <code>plot</code>, which combines several different options in a flexible framework for most commonly used purposes. The <code>explorespec</code> function aims at providing initial exploratory analysis, as demonstrated in Section 1. Finally, <code>aggplot</code> provides a simple framework for publication-quality plots of aggregated spectral data.</p>
<div id="the-plot-function-options" class="section level2">
<h2 class="hasAnchor">
<a href="#the-plot-function-options" class="anchor"></a>The <code>plot</code> Function Options</h2>
<p>Since <code>pavo</code> uses the class <code>rspec</code> to identify spectral data, the function <code>plot.rspec</code> can be called simply by calling <code>plot(data)</code>. If the object is not of class <code>rspec</code> the multivariate visualization methods will not work as expected, so it might be useful to check the data using <code>is.rspec</code> and convert with <code>as.rspec</code> if necessary.</p>
<p>We have implemented three methods of visualizing spectral data using <code>plot</code>:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Overlay</strong>: all spectra plotted with same x- and y-axis</li>
<li>
<strong>Stack</strong>: spectra plotted with same x-axis but arranged vertically along y-axis</li>
<li>
<strong>Heatmap</strong>: false color map to illustrate three dimensional data</li>
</ol>
<p>These options are in addition to the exploratory plotting offered by <code>explorespec</code>, as seen in the figures in section 1. To showcase the capabilities of <code>plot.rspec</code>, we will use the <code>teal</code> dataset included in <code>pavo</code>. This dataset consists of reflectance spectra from the iridescent wing patch of a green-winged teal (<em>Anas carolinensis</em>). Reflectance measurements were taken between 300 and 700 nm at different incident angles, ranging from 15<sup>o</sup> to 70<sup>o</sup> (in 5<sup>o</sup> increments) (Eliason &amp; Shawkey, 2012).</p>
<div id="the-overlay-option" class="section level3">
<h3 class="hasAnchor">
<a href="#the-overlay-option" class="anchor"></a>The <code>overlay</code> Option</h3>
<p>We can start out by visualizing these spectra with the <code>overlay</code> option in plot. Another neat option <code>pavo</code> offers is to convert reflectance spectra to their approximate perceived color, by using the function <code>spec2rgb</code>. This can make for some very interesting plots and even exploratory data analysis, as shown above.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="kw">data</span>(teal)</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="kw">plot</span>(teal, <span class="dt">type =</span> <span class="st">"o"</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(teal))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-25-1.png" alt="_Overlay plot of the teal angle-dependent reflectance with colors of each curve being an approximation of the perceived color._" width="480"><p class="caption">
<em>Overlay plot of the teal angle-dependent reflectance with colors of each curve being an approximation of the perceived color.</em>
</p>
</div>
</div>
<div id="the-stack-option" class="section level3">
<h3 class="hasAnchor">
<a href="#the-stack-option" class="anchor"></a>The <code>stack</code> Option</h3>
<p>Another option is the <code>stack</code> plot (again, with human vision approximations of the color produced by the spectra using <code>spec2rgb</code>).</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">teal.norm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(teal, <span class="dt">opt =</span> <span class="kw">c</span>(<span class="st">"min"</span>, <span class="st">"max"</span>))</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a minimum value of zero
## Scaling spectra to a maximum value of 1</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"></a>
<a class="sourceLine" id="cb70-3" data-line-number="3"><span class="kw">plot</span>(teal, <span class="dt">type =</span> <span class="st">"s"</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(teal))</a>
<a class="sourceLine" id="cb70-4" data-line-number="4"><span class="kw">plot</span>(teal.norm, <span class="dt">type =</span> <span class="st">"s"</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(teal))</a>
<a class="sourceLine" id="cb70-5" data-line-number="5"></a>
<a class="sourceLine" id="cb70-6" data-line-number="6"><span class="kw">mtext</span>(<span class="st">"Wavelength (nm)"</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> T, <span class="dt">line =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb70-7" data-line-number="7"><span class="kw">mtext</span>(<span class="st">"Cumulative reflectance (A.U.)"</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">outer =</span> T, <span class="dt">line =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-26-1.png" alt="_Stack plot of the raw (left) and normalized (right) teal angle-dependent reflectance_" width="384"><p class="caption">
<em>Stack plot of the raw (left) and normalized (right) teal angle-dependent reflectance</em>
</p>
</div>
<p>Note that in the above figure, the y axis to the right includes the index of each spectrum. This makes it easier to identify and subset specific spectra or groups of spectra using the <code>select</code> argument in <code>plot.rspec</code>. Note also that the first index is actually 2, preserving the sequence in the original dataset (since the first column is wavelength). Though this may seem confusing at first (“why is my first spec number 2?”") this preserves subsetting hierarchy: using <code>plot(teal, select = 2)</code> will show the same spectra that would be selected if you use <code>teal[ ,2]</code>.</p>
</div>
<div id="the-heatmap-option" class="section level3">
<h3 class="hasAnchor">
<a href="#the-heatmap-option" class="anchor"></a>The <code>heatmap</code> Option</h3>
<p>Since this dataset is three-dimensional (containing wavelengths, reflectance values and incident angles) we can also use the <code>heatmap</code> function. First, it will be necessary to define a vector for the incident angles each spectrum was measured at:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">angles &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">15</span>, <span class="dv">70</span>, <span class="dt">by =</span> <span class="dv">5</span>)</a></code></pre></div>
<p>Next, we will smooth the data with <code>procspec</code> and plot as a false color map (heatmap):</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">teal.sm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(teal, <span class="dt">opt =</span> <span class="kw">c</span>(<span class="st">"smooth"</span>))</a></code></pre></div>
<pre><code>## processing options applied:
## smoothing spectra with a span of 0.25</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">plot</span>(teal.sm,</a>
<a class="sourceLine" id="cb74-2" data-line-number="2">  <span class="dt">type =</span> <span class="st">"h"</span>, <span class="dt">varying =</span> angles,</a>
<a class="sourceLine" id="cb74-3" data-line-number="3">  <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">"Incident angle ("</span>, degree, <span class="st">")"</span>)),</a>
<a class="sourceLine" id="cb74-4" data-line-number="4">  <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">useRaster =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb74-5" data-line-number="5">)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-28-1.png" alt="_Heatmap plot for angle-resolved reflectance measurements of the green-winged teal._" width="480"><p class="caption">
<em>Heatmap plot for angle-resolved reflectance measurements of the green-winged teal.</em>
</p>
</div>
<p>These plots can be very useful to observe changes over time, for example, or any other type of continuous variation.</p>
</div>
</div>
<div id="the-aggplot-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-aggplot-function" class="anchor"></a>The <code>aggplot</code> Function</h2>
<p><code>aggplot</code> has a very similar interface to <code>aggspec</code>, allowing for quick plotting of aggregated spectra combined by a factor, such as species, sex, experimental treatment, and so on. Its main output is a plot with lines of group mean spectra outlined by a shaded area indicating some measure of variability, such as the standard deviation of the group. Note that functions that aren’t already implemented in R must be passed like they would be to functions such as <code>apply</code> (e.g., <code>function(x)sd(x)/sqrt(length(x))</code> in the example below).</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"></a>
<a class="sourceLine" id="cb75-3" data-line-number="3"><span class="co"># Plot using median and standard deviation, default colors</span></a>
<a class="sourceLine" id="cb75-4" data-line-number="4"><span class="kw"><a href="../reference/aggplot.html">aggplot</a></span>(mspecs, spp, <span class="dt">FUN.center =</span> median, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">legend =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb75-5" data-line-number="5"></a>
<a class="sourceLine" id="cb75-6" data-line-number="6"><span class="co"># Plot using mean and standard error, in greyscale</span></a>
<a class="sourceLine" id="cb75-7" data-line-number="7"><span class="kw"><a href="../reference/aggplot.html">aggplot</a></span>(mspecs, spp,</a>
<a class="sourceLine" id="cb75-8" data-line-number="8">  <span class="dt">FUN.error =</span> <span class="cf">function</span>(x) <span class="kw">sd</span>(x) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">length</span>(x)),</a>
<a class="sourceLine" id="cb75-9" data-line-number="9">  <span class="dt">lcol =</span> <span class="dv">1</span>, <span class="dt">shadecol =</span> <span class="st">"grey"</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span></a>
<a class="sourceLine" id="cb75-10" data-line-number="10">)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-29-1.png" alt="_Example plots created using `aggplot`. Left: using median, standard deviation, and colored lines. Right: using mean, standard error, and greyscale_" width="576"><p class="caption">
<em>Example plots created using <code>aggplot</code>. Left: using median, standard deviation, and colored lines. Right: using mean, standard error, and greyscale</em>
</p>
</div>
</div>
</div>
<div id="analyzing-spectral-data" class="section level1">
<h1 class="hasAnchor">
<a href="#analyzing-spectral-data" class="anchor"></a>Analyzing Spectral Data</h1>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p><code>pavo</code> offers two main approaches for spectral data analysis. First, color variables can be calculated based on the shape of the reflectance spectra. By using special <code>R</code> classes for spectra data frame objects, this can easily be done using the <code>summary</code> function with an <code>rspec</code> object (see below). The function <code>peakshape</code> also returns descriptors for individual peaks in spectral curves, as outlined below.</p>
<p>Second, reflectance spectra can be analyzed by accounting for the visual system receiving the color signal, therefore representing reflectance spectra as perceived colors. To that end, we have implemented a suite of visual models and colorspaces including; the receptor-noise limited model of model of Vorobyev &amp; Osorio (1998), Endler’s (1990) segment classification method, flexible di- tri- and tetra-chromatic colorspaces, the Hexagon model of Chittka (1992), the color-opponent coding space of Backhaus (1991), CIELAB and CIEXYZ spaces, and the categorical model of Troje (1992).</p>
</div>
<div id="spectral-shape-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#spectral-shape-analysis" class="anchor"></a>Spectral Shape Analysis</h2>
<div id="colorimetric-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#colorimetric-variables" class="anchor"></a>Colorimetric Variables</h3>
<p>Obtaining colorimetric variables (peratining to hue, saturation and brightness/value) is pretty straightforward in <code>pavo</code>. Since reflectance spectra is stored in an object of class <code>rspec</code>, the <code>summary</code> function recognizes the object as such and extracts 23 variables, as outlined in Montgomerie (2006). Though outlined in a book chapter on bird coloration, these variables are broadly applicable to any reflectance data, particularly if the taxon of interest has color vision within the UV-human visible range.</p>
<p>The description and formulas for these variables can be found by running <code><a href="../reference/summary.rspec.html">?summary.rspec</a></code>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">summary</span>(spec.sm)</a></code></pre></div>
<pre><code>##               B1    B2    B3  S1U  S1V  S1B  S1G  S1Y  S1R    S2   S3   S4
## cardinal 8984.27 22.40 52.70 0.17 0.19 0.12 0.19 0.25 0.53  7.61 0.30 0.20
## jacana   9668.50 24.11 53.79 0.10 0.11 0.19 0.31 0.25 0.41  7.10 0.25 0.05
## oriole   9108.47 22.71 54.16 0.07 0.08 0.06 0.33 0.36 0.55 14.51 0.30 0.09
## parakeet 6020.73 15.01 29.87 0.17 0.19 0.14 0.42 0.34 0.27  5.11 0.45 0.27
## robin    5741.39 14.32 37.86 0.09 0.10 0.14 0.27 0.27 0.51  9.13 0.30   NA
## tanager  8515.25 21.24 30.48 0.20 0.24 0.26 0.32 0.24 0.22  3.23 0.33 0.17
##               S5    S6    S7   S8    S9  S10  H1  H2  H3   H4  H5
## cardinal 4003.47 45.77 -0.21 2.04  0.84 0.41 700 419 587 0.02 581
## jacana   3314.02 46.21 -0.31 1.92  0.73 0.10 700 593 529 0.72 468
## oriole   5233.01 50.42 -0.58 2.22  0.92 0.19 700 382 551 0.41 544
## parakeet 1894.02 24.02  0.67 1.60  0.59 0.44 572 618 634 0.98 506
## robin    2532.41 33.71 -0.11 2.35  0.81   NA 700  NA 593 0.42 631
## tanager  1106.47 21.03 -0.79 0.99 -0.05 0.17 557 594 362 1.53 518</code></pre>
<p><code>summary</code> also takes an additional argument <code>subset</code> which if changed from the default <code>FALSE</code> to <code>TRUE</code> will return only the most commonly used colorimetrics (Andersson 2006). <code>summary</code> can also take a vector of color variable names, which can be used to filter the results</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">summary</span>(spec.sm, <span class="dt">subset =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##             B2   S8  H1
## cardinal 22.40 2.04 700
## jacana   24.11 1.92 700
## oriole   22.71 2.22 700
## parakeet 15.01 1.60 572
## robin    14.32 2.35 700
## tanager  21.24 0.99 557</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="co"># Extract only brightness variables</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="kw">summary</span>(spec.sm, <span class="dt">subset =</span> <span class="kw">c</span>(<span class="st">'B1'</span>, <span class="st">'B2'</span>, <span class="st">'B3'</span>))</a></code></pre></div>
<pre><code>##               B1    B2    B3
## cardinal 8984.27 22.40 52.70
## jacana   9668.50 24.11 53.79
## oriole   9108.47 22.71 54.16
## parakeet 6020.73 15.01 29.87
## robin    5741.39 14.32 37.86
## tanager  8515.25 21.24 30.48</code></pre>
</div>
<div id="peak-shape-descriptors" class="section level3">
<h3 class="hasAnchor">
<a href="#peak-shape-descriptors" class="anchor"></a>Peak Shape Descriptors</h3>
<p>Particularly in cases of reflectance spectra that have multiple discrete peaks (in which case the <code>summary</code> function will only return variables based on the tallest peak in the curve), it might be useful to obtain variables that describe individual peak’s properties. The <code>peakshape</code> function identifies the peak location (<code>H1</code>), returns the reflectance at that point (<code>B3</code>), and identifies the wavelengths at which the reflectance is half that at the peak, calculating the wavelength bandwidth of that interval (the Full Width at Half Maximum, or <code>FWHM</code>). The function also returns the half widths, which are useful when the peaks are located near the edge of the measurement limit and half maximum reflectance can only be reliably estimated from one of its sides.</p>
<p>If this all sounds too esoteric, fear not: <code>peakshape</code> has the option of returning plots indicating what it’s calculating. The vertical continuous red line indicates the peak location, the horizontal continuous red line indicates the half-maximum reflectance, and the distance between the dashed lines (<code>HWHM.l</code> and <code>HWHM.r</code>) is the FWHM:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="kw"><a href="../reference/peakshape.html">peakshape</a></span>(spec.sm, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-36-1.png" alt="_Plots from `peakshape`_" width="480"><p class="caption">
<em>Plots from <code>peakshape</code></em>
</p>
</div>
<pre><code>##         id       B3  H1 FWHM HWHM.l HWHM.r incl.min
## 1 cardinal 52.70167 700   NA    113     NA      Yes
## 2   jacana 53.78744 700   NA    171     NA      Yes
## 3   oriole 54.15508 700   NA    149     NA      Yes
## 4 parakeet 29.86504 572  125     62     63      Yes
## 5    robin 37.85542 700   NA    107     NA      Yes
## 6  tanager 30.48108 557  281    195     86      Yes</code></pre>
<p>As it can be seen, the variable FWHM is meaningless if the curve doesn’t have a clear peak. Sometimes, such as in the case of the Cardinal (Above figure, first panel), there might be a peak which is not the point of maximum reflectance of the entire spectral curve. The half-width can also be erroneously calculated when there are two peaks, as can be seen in the case of the Tanager (Above figure, last panel). In this case, it’s useful to set wavelength limits when calculating the FWHM by using the <code>lim</code> argument. <code>peakshape</code> also offers a <code>select</code> argument to facilitate subsetting the spectra data frame to, for example, focus on a single reflectance peak:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw"><a href="../reference/peakshape.html">peakshape</a></span>(spec.sm, <span class="dt">select =</span> <span class="dv">2</span>, <span class="dt">lim =</span> <span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">500</span>), <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-37-1.png" alt="_Plot from `peakshape`, setting the wavelength limits to 300 and 500 nm_" width="480"><p class="caption">
<em>Plot from <code>peakshape</code>, setting the wavelength limits to 300 and 500 nm</em>
</p>
</div>
<pre><code>##         id       B3  H1 FWHM HWHM.l HWHM.r incl.min
## 1 cardinal 17.84381 369   99     45     54      Yes</code></pre>
</div>
</div>
<div id="visual-modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#visual-modelling" class="anchor"></a>Visual Modelling</h2>
<div id="overview-1" class="section level3">
<h3 class="hasAnchor">
<a href="#overview-1" class="anchor"></a>Overview</h3>
<p>As of version <code>1.0</code>, all visual and colorspace modelling and plotting options are wrapped into four main function: <code>vismodel</code>, <code>colspace</code>, <code>coldist</code>, and <code>plot</code>. As detailed below, these functions cover the basic processes common to most modelling approaches. Namely, the estimation of quantum catches, their conversion to an appropriate space, estimating the distances between samples, and visualising the results. As a brief example, a typical workflow for modelling might use:</p>
<ol style="list-style-type: decimal">
<li>
<code>vismodel</code> to estimate photoreceptor quantum catches. The assumptions of visual models may differ dramatically, so be sure to select options that are appropriate for your intended use.<br>
</li>
<li>
<code>colspace</code> to convert the results of <code>vismodel</code> (or user-provided quantum catches) into points in a given colorspace, specified with the <code>space</code> argument. If no <code>space</code> argument is provided, <code>colspace</code> will automatically select the di-, tri- or tetrahedral colorspace, depending on the nature of the input data. The result of <code>colspace</code> will be an object of class <code>colspace</code> (that inherits from <code>data.frame</code>), and will contain the location of stimuli in the selected space along with any associated color variables.</li>
<li>
<code>coldist</code> to estimate the color distances between points in a colourspace (if the input is from <code>colspace</code>), or the ‘perceptual’, noise-weighted distances in the receptor-noise limited model (if the input is from <code>vismodel</code> where <code>relative = FALSE</code>).</li>
<li>
<code>plot</code> the output. <code>plot</code> will automatically select the appropriate visualisation based on the input <code>colspace</code> object, and will also accept various graphical parameters depending on the colorspace (see <code><a href="../reference/plot.colspace.html">?plot.colspace</a></code> and links therein for details).</li>
</ol>
</div>
<div id="accessing-and-plotting-in-built-spectral-data" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-and-plotting-in-built-spectral-data" class="anchor"></a>Accessing and Plotting In-built Spectral Data</h3>
<p>All in-built spectral data in <code>pavo</code> can be easily retrieved and/or plotted via the <code><a href="../reference/sensdata.html">sensdata()</a></code> function. These data can be visualised directly by including <code>plot = TRUE</code>, or assigned to an object for subsequent use, as in:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">musca_sense &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensdata.html">sensdata</a></span>(<span class="dt">visual =</span> <span class="st">"musca"</span>, <span class="dt">achromatic =</span> <span class="st">"md.r1"</span>)</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="kw">head</span>(musca_sense)</a></code></pre></div>
<pre><code>##    wl    musca.u     musca.s     musca.m     musca.l       md.r1
## 1 300 0.01148992 0.006726680 0.001533875 0.001524705 0.001713692
## 2 301 0.01152860 0.006749516 0.001535080 0.001534918 0.001731120
## 3 302 0.01156790 0.006773283 0.001536451 0.001545578 0.001751792
## 4 303 0.01160839 0.006798036 0.001537982 0.001556695 0.001775960
## 5 304 0.01165060 0.006823827 0.001539667 0.001568283 0.001803871
## 6 305 0.01169510 0.006850712 0.001541499 0.001580352 0.001835777</code></pre>
</div>
<div id="visual-phenotypes" class="section level3">
<h3 class="hasAnchor">
<a href="#visual-phenotypes" class="anchor"></a>Visual Phenotypes</h3>
<dl>
<dt>
<code>pavo</code> contains numerous di-, tri- and tetrachromatic visual systems, to accompany the suite of new models. The full complement of included systems are accessable via the <code><a href="../reference/vismodel.html">vismodel()</a></code> argument <code>visual</code>:</dt>
<dd>
<code>avg.uv</code> average ultraviolet-sensitive avian (tetrachromat)
</dd>
<dd>
<code>avg.v</code> average violet-sensitive avian (tetrachromat)
</dd>
<dd>
<code>bluetit</code> The blue tit <em>Cyanistes caeruleus</em> (tetrachromat)
</dd>
<dd>
<code>star</code> The starling <em>Sturnus vulgaris</em> (tetrachromat)
</dd>
<dd>
<code>pfowl</code> The peafowl <em>Pavo cristatus</em> (tetrachromat)
</dd>
<dd>
<code>apis</code> The honeybee <em>Apis mellifera</em> (trichromat)
</dd>
<dd>
<code>ctenophorus</code> The ornate dragon lizard <em>Ctenophorus ornatus</em> (trichromat)
</dd>
<dd>
<code>canis</code> The canid <em>Canis familiaris</em> (dichromat)
</dd>
<dd>
<code>musca</code> The housefly <em>Musca domestica</em> (tetrachromat)
</dd>
<dd>
<code>cie2</code> 2-degree color matching functions for CIE models of human color vision (trichromat)
</dd>
<dd>
<code>cie10</code> 10-degree color matching functions for CIE models of human color vision (trichromat)
</dd>
<dd>
<code>segment</code> A generic ‘viewer’ with broad sensitivities for use in the segment analysis of Endler (1990) (tetrachromat)
</dd>
<dd>
<code>habronattus</code> The jumping spider <em>Habronattus pyrrithrix</em> (trichromat).
</dd>
<dd>
<code>rhinecanthus</code> The triggerfish <em>Rhinecanthus aculeatus</em> (trichromat).
</dd>
</dl>
</div>
<div id="estimating-quantum-catch" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-quantum-catch" class="anchor"></a>Estimating Quantum Catch</h3>
<p>Numerous models have been developed to understand how colors are perceived and discriminated by an individual’s or species’ visual system (Described in detail in Endler 1990; Renoult et al. 2015; Vorobyev 1998). In essence, these models take into account the receptor sensitivity of the different receptors that make the visual system in question and quantify how a given color would stimulate those receptors individually, and their combined effect on the perception of color. These models also have an important component of assuming and interpreting the chromatic component of color (hue and saturation) to be processed independently of the achromatic (brightness, or luminance) component. This provides a flexible framework allowing for a tiered model construction, in which information on aspects such as different illumination sources, backgrounds, and visual systems can be considered and compared.</p>
<p>To apply any such model, we first need to quantify receptor excitation and then consider how the signal is being processed, while possibly considering the relative density of different cones and the noise-to-signal ratio.</p>
<p>To quantify the stimulation of cones by the emitted color, we will use the <code>pavo</code> function <code>vismodel</code>. This function takes an <code>rspec</code> dataframe as a minimal input, and the user can either select from the available options or input its own data for the additional arguments in the function:</p>
<ul>
<li>
<code>visual</code>: the visual system to be used. Available inbuilt options are detailed above, or the user may include their own dataframe, with the first column being the wavelength range and the following columns being the absorbance at each wavelength for each cone type (see below for an example).</li>
<li>
<code>achromatic</code>: Either a receptor’s sensitivity data (available options include the blue tit, chicken, and starling double-cones, and the housefly’s R1-6 receptor), which can also be user-defined as above; or the longest-wavelength receptor, the sum of the two longest-wavelength receptors, or the sum of all receptors can be used. Alternatively, <code>none</code> can be specified for no achromatic stimulation calculation.</li>
<li>
<code>illum</code>: The illuminant being considered. By default, it considers an ideal white iluminant, but implemented options are a blue sky, standard daylight, and forest shade illuminants. A vector of same length as the wavelength range being considered can also be used as the input.</li>
<li>
<code>trans</code>: Models of the effects of light transmission (e.g. through noisy environments or ocular filters). The argument defaults to <code>ideal</code> (i.e. no effect), though users can also use the built-in options of <code>bluetit</code> or <code>blackbird</code> to model the ocular transmission of blue tits/blackbirds, or specify a user-defined vector containing transmission spectra.</li>
<li>
<code>qcatch</code>: This argument determines what photon catch data should be returned
<ul>
<li>
<code>Qi</code>: The receptor quantum catches, calculated for receptor <span class="math inline">\(i\)</span> as: <span class="math display">\[Q_i = \int_\lambda{R_i(\lambda)S(\lambda)I(\lambda)d\lambda}\]</span> Where <span class="math inline">\(\lambda\)</span> denotes the wavelength, <span class="math inline">\(R_i(\lambda)\)</span> the spectral sensitivity of receptor <span class="math inline">\(i\)</span>, <span class="math inline">\(S (\lambda)\)</span> the reflectance spectrum of the color, and <span class="math inline">\(I(\lambda)\)</span> the illuminant spectrum.</li>
<li>
<code>fi</code>: The receptor quantum catches transformed according to Fechner’s law, in which the signal of the receptor is proportional to the logarithm of the quantum catch i.e. <span class="math inline">\(f_i = ln(Q_i)\)</span>
</li>
<li>
<code>Ei</code>: the hyperbolic transform (a simplification of the Michaelis–Menton photoreceptor equation), where <span class="math display">\[E_i = \frac{Q_i}{Q_i + 1}\]</span>.</li>
</ul>
</li>
<li>
<code>bkg</code>: The background being considered. By default, it considers an idealized background (i.e. wavelength-independent influence of the background on color). A vector of same length as the wavelength range being considered can also be used as the input.</li>
<li>
<code>vonkries</code>: a logical argument which determines if the von Kries transformation (which normalizes receptor quantum catches to the background, thus accounting for receptor adaptation) is to be applied (defaults to <code>FALSE</code>). If <code>TRUE</code>, <span class="math inline">\(Q_i\)</span> is multiplied by a constant <span class="math inline">\(k\)</span>, which describes the von Kries transformation: <span class="math display">\[k_i = \frac{1} { \int_\lambda{R_i(\lambda)S^b(\lambda)I(\lambda)d\lambda }, }\]</span> Where <span class="math inline">\(S^b\)</span> denotes the reflectance spectra of the background.</li>
<li>
<code>scale</code>: This argument defines how the illuminant should be scaled. The scale of the illuminant is critical of receptor noise models in which the signal intensity influences the noise (see Receptor noise section, below). Illuminant curves should be in units of <span class="math inline">\(\mu mol.s^{-1}.m^{-2}\)</span> in order to yield physiologically meaningful results. (Some software return illuminant information values in <span class="math inline">\(\mu Watt.cm^{-2}\)</span>, and must be converted to <span class="math inline">\(\mu mol.s^{-1}.m^{-2}\)</span>. This can be done by using the <code>irrad2flux</code> and <code>flux2irrad</code> functions.) Therefore, if the user-specified illuminant curves are <em>not</em> in these units (i.e. are measured proportional to a white standard, for example), the <code>scale</code> parameter can be used as a multiplier to yield curves that are at least a reasonable approximation of the illuminant value. Commonly used values are <strong>500</strong> for dim conditions and <strong>10,000</strong> for bright conditions.</li>
<li>
<code>relative</code>: If <code>TRUE</code>, it will make the cone stimulations relative to their sum. This is appropriate for colorspace models such as the avian tetrahedral colorspace (Goldsmith 1990, Stoddard 2008; For the photon catch and neural noise model, it is important to set} <code>relative = FALSE</code>).</li>
</ul>
<p>All visual models begin with the estimation of receptor quantum catches. The requirements of models may differ significantly of course, so be sure to consult the function documentation and original publications. For this example, we will use the average reflectance of the different species to calculate the raw stimulation of retinal cones, considering the avian average UV visual system, a standard daylight illumination, and an idealized background.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">vismod1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sppspec,</a>
<a class="sourceLine" id="cb88-2" data-line-number="2">  <span class="dt">visual =</span> <span class="st">"avg.uv"</span>, <span class="dt">achromatic =</span> <span class="st">"bt.dc"</span>,</a>
<a class="sourceLine" id="cb88-3" data-line-number="3">  <span class="dt">illum =</span> <span class="st">"D65"</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb88-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb88-5" data-line-number="5">vismod1</a></code></pre></div>
<pre><code>##               u      s      m      l    lum
## cardinal 0.0341 0.0649 0.1297 0.4187 0.1939
## jacana   0.0199 0.1484 0.2923 0.3313 0.2709
## oriole   0.0139 0.0375 0.2649 0.4807 0.2755
## parakeet 0.0186 0.0611 0.2542 0.2171 0.2042
## robin    0.0109 0.0622 0.1413 0.2420 0.1501
## tanager  0.0418 0.1572 0.2747 0.2284 0.2346</code></pre>
<p>Since there are multiple parameters that can be used to customize the output of <code>vismodel</code>, as detailed above, for convenience these can be returned by using <code>summary</code> in a <code>vismodel</code> object:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">summary</span>(vismod1)</a></code></pre></div>
<pre><code>## visual model options:
##  * Quantal catch: Qi 
##  * Visual system, chromatic: avg.uv 
##  * Visual system, achromatic: bt.dc 
##  * Illuminant: D65, scale = 1 (von Kries color correction not applied) 
##  * Background: ideal 
##  * Transmission: ideal 
##  * Relative: FALSE</code></pre>
<pre><code>##        u                 s                 m                l         
##  Min.   :0.01093   Min.   :0.03749   Min.   :0.1297   Min.   :0.2171  
##  1st Qu.:0.01509   1st Qu.:0.06137   1st Qu.:0.1695   1st Qu.:0.2318  
##  Median :0.01925   Median :0.06353   Median :0.2595   Median :0.2866  
##  Mean   :0.02321   Mean   :0.08854   Mean   :0.2262   Mean   :0.3197  
##  3rd Qu.:0.03059   3rd Qu.:0.12753   3rd Qu.:0.2722   3rd Qu.:0.3969  
##  Max.   :0.04177   Max.   :0.15716   Max.   :0.2923   Max.   :0.4807  
##       lum        
##  Min.   :0.1501  
##  1st Qu.:0.1965  
##  Median :0.2194  
##  Mean   :0.2215  
##  3rd Qu.:0.2618  
##  Max.   :0.2755</code></pre>
<p>We can visualize what vismodel is doing when estimating quantum catches by comparing the reflectance spectra to the estimates they are generating:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="kw">layout</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">11</span>), <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">11</span>)))</a>
<a class="sourceLine" id="cb93-3" data-line-number="3"></a>
<a class="sourceLine" id="cb93-4" data-line-number="4">sppspecol &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(sppspec))</a>
<a class="sourceLine" id="cb93-5" data-line-number="5"></a>
<a class="sourceLine" id="cb93-6" data-line-number="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb93-7" data-line-number="7">  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb93-8" data-line-number="8">  <span class="kw">plot</span>(sppspec, <span class="dt">select =</span> i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">col =</span> sppspecol[i], <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb93-9" data-line-number="9">  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">4.1</span>, <span class="fl">2.5</span>, <span class="fl">2.5</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb93-10" data-line-number="10">  <span class="kw">barplot</span>(<span class="kw">as.matrix</span>(vismod1[i, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]), <span class="dt">yaxt =</span> <span class="st">"n"</span>, <span class="dt">col =</span> <span class="st">"black"</span>)</a>
<a class="sourceLine" id="cb93-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb93-12" data-line-number="12"></a>
<a class="sourceLine" id="cb93-13" data-line-number="13"><span class="kw">mtext</span>(<span class="st">"Wavelength (nm)"</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb93-14" data-line-number="14"><span class="kw">mtext</span>(<span class="st">"Reflectance (%)"</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-42-1.png" alt="_Plots of species mean reflectance curves with corresponding relative usml cone stimulations (insets)._" width="576"><p class="caption">
<em>Plots of species mean reflectance curves with corresponding relative usml cone stimulations (insets).</em>
</p>
</div>
<p>As described above, <code>vismodel</code> also accepts user-defined visual systems, background and illuminants. We will illustrate this by showcasing the function <code>sensmodel</code>, which models spectral sensitivities of retinas based on their peak cone sensitivity, as described in Govardovskii et al. (2000) and Hart &amp; Vorobyev (2005). <code>sensmodel</code> takes several optional arguments, but the main one is a vector containing the peak sensitivities for the cones being modeled. Let’s model an idealized dichromat visual system, with cones peaking in sensitivity at 350 and 650 nm:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">idealizeddichromat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensmodel.html">sensmodel</a></span>(<span class="kw">c</span>(<span class="dv">350</span>, <span class="dv">650</span>))</a>
<a class="sourceLine" id="cb94-2" data-line-number="2"><span class="kw">plot</span>(idealizeddichromat, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(idealizeddichromat), <span class="dt">ylab =</span> <span class="st">"Absorbance"</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-43-1.png" alt="_Idealized dichromat photoreceptors created using `sensmodel`._" width="480"><p class="caption">
<em>Idealized dichromat photoreceptors created using <code>sensmodel</code>.</em>
</p>
</div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">vismod.idi &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sppspec, <span class="dt">visual =</span> idealizeddichromat, <span class="dt">relative =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb95-2" data-line-number="2">vismod.idi</a></code></pre></div>
<pre><code>##      lmax350 lmax650
## [1,]  0.1458  0.3519
## [2,]  0.0916  0.3179
## [3,]  0.0698  0.3776
## [4,]  0.1058  0.1727
## [5,]  0.0473  0.2175
## [6,]  0.1644  0.2149</code></pre>
</div>
<div id="the-receptor-noise-model" class="section level3">
<h3 class="hasAnchor">
<a href="#the-receptor-noise-model" class="anchor"></a>The Receptor Noise Model</h3>
<p>The receptor-noise limited model of Vorobyev (1998, 2001) offers a basis for estimating the ‘perceptual’ distance between coloured stimuli (depending on available physiological and behavioural data), and assumes that the simultaneous discrimination of colors is fundamentally limited by photoreceptor noise. Color distances under the RNL model can be calculated by using the inverse of the noise-to-signal ratio, known as the Weber fraction (<span class="math inline">\(w_i\)</span> for each cone <span class="math inline">\(i\)</span>). The Weber fraction can be calculated from the noise-to-signal ratio of cone <span class="math inline">\(i\)</span> (<span class="math inline">\(v_i\)</span>) and the relative number of receptor cells of type <span class="math inline">\(i\)</span> within the receptor field (<span class="math inline">\(n_i\)</span>):</p>
<p><span class="math display">\[w_i = \frac{v_i}{\sqrt{n_i}}\]</span></p>
<p><span class="math inline">\(w_i\)</span> is the value used for the noise when considering only neural noise mechanisms. Alternatively, the model can consider that the intensity of the color signal itself contributes to the noise (photoreceptor, or quantum, noise). In this case, the noise for a receptor <span class="math inline">\(i\)</span> is calculated as:</p>
<p><span class="math display">\[w_i = \sqrt{\frac{v_i^2}{\sqrt{n_i}}  + \frac{2}{Q_a+Q_b}}\]</span></p>
<p>where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> refer to the two color signals being compared. Note that when the values of <span class="math inline">\(Q_a\)</span> and <span class="math inline">\(Q_b\)</span> are very high, the second portion of the equation tends to zero, and the both formulas should yield similar results. Hence, it is important that the quantum catch are calculated in the appropriate illuminant scale, as described above.</p>
<p>Color distances are obtained by weighting the Euclidean distance of the photoreceptor quantum catches by the Weber fraction of the cones (<span class="math inline">\(\Delta S\)</span>). These measurements are in units of Just Noticeable Differences (JNDs), where distances over a certain threshold (usually 1) are considered to be discernible under the conditions considered (e.g., backgrounds, illumination). The equations used in these calculations are:</p>
<p>For dichromats: <span class="math display">\[\Delta S = \sqrt{\frac{(\Delta f_1 - \Delta f_2)^2}{w_1^2+w_2^2}}\]</span></p>
<p>For trichromats: <span class="math display">\[\Delta S = \sqrt{\frac{w_1^2(\Delta f_3 - \Delta f_2)^2 + w_2^2(\Delta f_3 - \Delta f_1)^2 + 
w_3^2(\Delta f_1 - \Delta f_2)^2 }{ (w_1w_2)^2 + (w_1w_3)^2 + (w_2w_3)^2 }}\]</span></p>
<p>For tetrachromats: <span class="math display">\[\Delta S = 
\sqrt{(w_1w_2)^2(\Delta f_4 - \Delta f_3)^2 + (w_1w_3)^2(\Delta f_4 - \Delta f_2)^2 + 
(w_1w_4)^2(\Delta f_3 - \Delta f_2)^2 + \\ (w_2w_3)^2(\Delta f_4 - \Delta f_1)^2 + 
(w_2w_4)^2(\Delta f_3 - \Delta f_1)^2 + (w_3w_4)^2(\Delta f_2 - \Delta f_1)^2 / \\ 
((w_1w_2w_3)^2 + (w_1w_2w_4)^2 + (w_1w_3w_4)^2 + (w_2w_3w_4)^2)}\]</span></p>
<p>For the chromatic contrast. The achromatic contrast (<span class="math inline">\(\Delta L\)</span>) can be calculated based on the double cone or the receptor (or combination of receptors) responsible for chromatic processing by the equation:</p>
<p><span class="math display">\[\Delta L =  \frac{\Delta f}{w}\]</span></p>
<div id="perceptual-distances-with-coldist" class="section level4">
<h4 class="hasAnchor">
<a href="#perceptual-distances-with-coldist" class="anchor"></a>Perceptual Distances with <code>coldist</code>
</h4>
<p><code>pavo</code> implements the noise-weighted color distance calculations in the function <code>coldist</code>, assuming that raw receptor quantum catches are provided (via <code>relative = FALSE</code> in <code><a href="../reference/vismodel.html">vismodel()</a></code>). For the achromatic contrast, <code>coldist</code> uses <code>n4</code> to calculate <span class="math inline">\(w\)</span> for the achromatic contrast. Note that even if <span class="math inline">\(Q_i\)</span> is chosen, values are still log-transformed. This option is available in case the user wants to specify a data frame of quantum catches that was not generated by <code>vismodel</code> as an input. In this case, the argument <code>qcatch</code> should be used to inform the function if <span class="math inline">\(Q_i\)</span> or <span class="math inline">\(f_i\)</span> values are being used (note that if the imput to <code>coldist</code> is an object generated using the <code>vismodel</code> function, this argument is ignored.) The type of noise to be calculated can be selected from the <code>coldist</code> argument <code>noise</code> (which accepts either <code>"neural"</code> or <code>"quantum"</code>).</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod1,</a>
<a class="sourceLine" id="cb97-2" data-line-number="2">  <span class="dt">noise =</span> <span class="st">"neural"</span>, <span class="dt">achro =</span> <span class="ot">TRUE</span>, <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">  <span class="dt">weber =</span> <span class="fl">0.1</span>, <span class="dt">weber.achro =</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb97-4" data-line-number="4">)</a></code></pre></div>
<pre><code>##      patch1   patch2        dS        dL
## 1  cardinal   jacana  8.423965 3.3449627
## 2  cardinal   oriole  7.905876 3.5110820
## 3  cardinal parakeet  7.999730 0.5177495
## 4  cardinal    robin  5.805562 2.5606167
## 5  cardinal  tanager 10.100311 1.9068807
## 6    jacana   oriole 10.151253 0.1661193
## 7    jacana parakeet  4.231570 2.8272132
## 8    jacana    robin  3.503769 5.9055794
## 9    jacana  tanager  5.126266 1.4380820
## 10   oriole parakeet  8.135793 2.9933325
## 11   oriole    robin  7.220505 6.0716987
## 12   oriole  tanager 13.608253 1.6042013
## 13 parakeet    robin  4.606847 3.0783661
## 14 parakeet  tanager  5.969760 1.3891312
## 15    robin  tanager  7.688707 4.4674974</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod.idi, <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">weber =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<pre><code>##      patch1   patch2        dS
## 1  cardinal   jacana 2.0993283
## 2  cardinal   oriole 4.6567462
## 3  cardinal parakeet 2.2575457
## 4  cardinal    robin 3.7236780
## 5  cardinal  tanager 3.5417700
## 6    jacana   oriole 2.5574178
## 7    jacana parakeet 4.3568740
## 8    jacana    robin 1.6243496
## 9    jacana  tanager 5.6410983
## 10   oriole parakeet 6.9142918
## 11   oriole    robin 0.9330682
## 12   oriole  tanager 8.1985162
## 13 parakeet    robin 5.9812236
## 14 parakeet  tanager 1.2842244
## 15    robin  tanager 7.2654480</code></pre>
<p>Where <code>dS</code> is the chromatic contrast (<span class="math inline">\(\Delta S\)</span>) and <code>dL</code> is the achromatic contrast (<span class="math inline">\(\Delta L\)</span>). Note that, by default, <code>achro = FALSE</code>, so <code>dL</code> isn’t included in the second result (this is to maintain consistency since, in the <code>vismodel</code> function, the <code>achromatic</code> argument defaults to <code>none</code>). As expected, values are really high under the avian color vision, since the colors of these species are quite different and because of the enhanced discriminatory ability with four compared to two cones.</p>
<p><code>coldist</code> also has a <code>subset</code> argument, which is useful if only certain comparisons are of interest (for example, of color patches against a background, or only comparisons among a species or body patch). <code>subset</code> can be a vector of length one or two. If only one subsetting option is passed, all comparisons against the matching argument are returned (useful in the case of comparing to a background, for example). If two values are passed, comparisons will only be made between samples that match that rule (partial string matching and regular expressions are accepted). For example, compare:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod1, <span class="dt">subset =</span> <span class="st">'cardinal'</span>)</a></code></pre></div>
<p>to:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod1, <span class="dt">subset =</span> <span class="kw">c</span>(<span class="st">'cardinal'</span>, <span class="st">'jacana'</span>))</a></code></pre></div>
</div>
<div id="converting-receptor-noise-corrected-distances-to-cartesian-coordinates" class="section level4">
<h4 class="hasAnchor">
<a href="#converting-receptor-noise-corrected-distances-to-cartesian-coordinates" class="anchor"></a>Converting receptor noise-corrected distances to Cartesian coordinates</h4>
<p>You can convert distances in JND back to Cartesian position coordinates with the function <code>jnd2xyz</code>. Note that the actual position of these points in the XYZ space is arbitrary; therefore the function allows you to rotate the data so that, for example, the vector leading to the long-wavelength cone aligns with the X axis:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">fakedata1 &lt;-<span class="st"> </span><span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb103-2" data-line-number="2">  <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dt">by =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb103-3" data-line-number="3">  <span class="cf">function</span>(x) <span class="kw">rowSums</span>(<span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb103-4" data-line-number="4">      <span class="kw">dnorm</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb103-5" data-line-number="5">      <span class="kw">dnorm</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x <span class="op">+</span><span class="st"> </span><span class="dv">400</span>, <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb103-6" data-line-number="6">    ))</a>
<a class="sourceLine" id="cb103-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb103-8" data-line-number="8"></a>
<a class="sourceLine" id="cb103-9" data-line-number="9"><span class="co"># Creating idealized specs with varying saturation</span></a>
<a class="sourceLine" id="cb103-10" data-line-number="10">fakedata2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb103-11" data-line-number="11">  <span class="kw">c</span>(<span class="dv">500</span>, <span class="dv">300</span>, <span class="dv">150</span>, <span class="dv">105</span>, <span class="dv">75</span>, <span class="dv">55</span>, <span class="dv">40</span>, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb103-12" data-line-number="12">  <span class="cf">function</span>(x) <span class="kw">dnorm</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="dv">550</span>, x)</a>
<a class="sourceLine" id="cb103-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb103-14" data-line-number="14"></a>
<a class="sourceLine" id="cb103-15" data-line-number="15">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw">data.frame</span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1))</a>
<a class="sourceLine" id="cb103-16" data-line-number="16">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata1, <span class="st">"max"</span>)</a>
<a class="sourceLine" id="cb103-17" data-line-number="17">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw">data.frame</span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata2))</a>
<a class="sourceLine" id="cb103-18" data-line-number="18">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"sum"</span>)</a>
<a class="sourceLine" id="cb103-19" data-line-number="19">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"min"</span>)</a>
<a class="sourceLine" id="cb103-20" data-line-number="20"></a>
<a class="sourceLine" id="cb103-21" data-line-number="21"><span class="co"># Converting reflectance to percentage</span></a>
<a class="sourceLine" id="cb103-22" data-line-number="22">fakedata1[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata1[, <span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb103-23" data-line-number="23">fakedata2[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata2[, <span class="dv">-1</span>] <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(fakedata2[, <span class="dv">-1</span>]) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb103-24" data-line-number="24"></a>
<a class="sourceLine" id="cb103-25" data-line-number="25"><span class="co"># Combining and converting to rspec</span></a>
<a class="sourceLine" id="cb103-26" data-line-number="26">fakedata.c &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1[, <span class="dv">-1</span>], fakedata2[, <span class="dv">-1</span>])</a>
<a class="sourceLine" id="cb103-27" data-line-number="27">fakedata.c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedata.c)</a></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="co"># Visual model and color distances</span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2">fakedata.vm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(fakedata.c, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">achro =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb104-3" data-line-number="3">fakedata.cd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(fakedata.vm,</a>
<a class="sourceLine" id="cb104-4" data-line-number="4">  <span class="dt">noise =</span> <span class="st">"neural"</span>, <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb104-5" data-line-number="5">  <span class="dt">weber =</span> <span class="fl">0.1</span>, <span class="dt">achro =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb104-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb104-7" data-line-number="7"></a>
<a class="sourceLine" id="cb104-8" data-line-number="8"><span class="co"># Converting to Cartesian coordinates</span></a>
<a class="sourceLine" id="cb104-9" data-line-number="9">fakedata.cc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/jnd2xyz.html">jnd2xyz</a></span>(fakedata.cd, <span class="dt">ref1 =</span> <span class="st">"l"</span>, <span class="dt">axis1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">ref2 =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb104-10" data-line-number="10"><span class="kw">head</span>(fakedata.cc)</a></code></pre></div>
<pre><code>##             x          y         z      lum
## X1 -26.165302   3.692783 -17.71718 1.533258
## X2 -11.212399  -2.085407 -27.97937 1.533258
## X3   3.076291  -7.441594 -37.76761 1.533258
## X4  16.523287 -12.475488 -46.33606 1.533255
## X5  25.812150 -17.848152 -40.71621 1.533213
## X6  31.912643 -23.368560 -24.79660 1.532744</code></pre>
<p>which you can then plot as well:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">plot</span>(fakedata.cc, <span class="dt">theta =</span> <span class="dv">55</span>, <span class="dt">phi =</span> <span class="dv">25</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(fakedata.c))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-52-1.png" alt="_Spectral data in a receptor noise-corrected colorspace_" width="384"><p class="caption">
<em>Spectral data in a receptor noise-corrected colorspace</em>
</p>
</div>
<p>The axes in this colorspace are in JND units. For more information on these functions, see <code><a href="../reference/jnd2xyz.html">?jnd2xyz</a></code>, <code><a href="../reference/jndrot.html">?jndrot</a></code> and <code><a href="../reference/jndplot.html">?jndplot</a></code>.</p>
</div>
</div>
<div id="colorspaces" class="section level3">
<h3 class="hasAnchor">
<a href="#colorspaces" class="anchor"></a>Colorspaces</h3>
<p>Another general, flexible representation of stimuli is the color space model. In such approaches, photon catches are expressed in relative values (so that the the quantum catches of all receptors involved in chromatic discrimination sum to 1). The maximum stimulation of each cone <span class="math inline">\(n\)</span> is placed at the vertex of a <span class="math inline">\((n-1)\)</span>-dimensional polygon that encompasses all theoretical colors that can be perceived by that visual system. For the avian visual system comprised of 4 cones, for example, all colors can be placed somewhere in the volume of a tetrahedron, in which each of the four vertices represents the maximum stimulation of that particular cone type.</p>
<p>Though these models do not account for receptor noise (and thus do not allow an estimate of JNDs), they presents several advantages. First, they make for a very intuitive representation of color points accounting for attributes of the color vision of the signal receiver. Second, they allow for the calculation of several interesting variables that represent color. For example, hue can be estimated from the angle of the point relative to the xy plane (blue-green-red) and the z axis (UV); saturation can be estimated as the distance of the point from the achromatic center.</p>
<p><code>data(flowers)</code> is a new example dataset consisting of reflectance spectra from 36 Australian angiosperm species, which we’ll use to illustrate for the following colorspace modelling.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">data</span>(flowers)</a>
<a class="sourceLine" id="cb107-2" data-line-number="2"></a>
<a class="sourceLine" id="cb107-3" data-line-number="3">flowercols &lt;-<span class="st"> </span><span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers)</a>
<a class="sourceLine" id="cb107-4" data-line-number="4"></a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="kw">head</span>(flowers[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a></code></pre></div>
<pre><code>##    wl Goodenia_heterophylla Goodenia_geniculata Goodenia_gracilis
## 1 300             1.7426387            1.918962         0.3638354
## 2 301             1.5724849            1.872966         0.3501921
## 3 302             1.4099808            1.828019         0.3366520
## 4 303             1.2547709            1.784152         0.3231911
## 5 304             1.1064997            1.741398         0.3097854
## 6 305             0.9648117            1.699792         0.2964107</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">plot</span>(flowers, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> flowercols)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-53-1.png" alt="_The flower dataset_" width="480"><p class="caption">
<em>The flower dataset</em>
</p>
</div>
<div id="di--tri--and-tetrachromatic-colorspaces" class="section level4">
<h4 class="hasAnchor">
<a href="#di--tri--and-tetrachromatic-colorspaces" class="anchor"></a>Di-, Tri-, and Tetrachromatic Colorspaces</h4>
<p>As of version <code>1.0</code>, <code>pavo</code> has expanded modeling and visualization capabilities for generic di- and trichromatic spaces, uniting these approaches in a cohesive workflow. As with most colorspace models, we first estimate relative quantum catches with various assumptions by using the <code>vismodel</code> function, before converting each set of values to a location in colorspace by using the <code>space</code> argument in <code>colspace</code> (the function can also be set to try to detect the dimensionality of the colorspace automatically). For di- tri- and tetrachromatic spaces, <code>colspace</code> calculates the coordinates of stimuli as:</p>
<p><strong>Dichromats:</strong> <span class="math display">\[x = \frac{1}{\sqrt{2}}(Q_l - Q_s)\]</span></p>
<p><strong>Trichromats:</strong> <span class="math display">\[x = \frac{1}{\sqrt{2}}(Q_l - Q_m)\]</span> <span class="math display">\[y = \frac{\sqrt{2}}{\sqrt{3}}(Q_s - \frac{Q_l + Q_m}{2})\]</span></p>
<p><strong>Tetrachromats:</strong> <span class="math display">\[x = \frac{1}{\sqrt{2}}(Q_l - Q_m)\]</span> <span class="math display">\[y = \frac{\sqrt{2}}{\sqrt{3}}(Q_s - \frac{Q_l + Q_m}{2})\]</span> <span class="math display">\[z = \frac{\sqrt{3}}{2}(Q_u - \frac{Q_l + Q_m + Q_s}{3})\]</span></p>
<p>Where Q<sub>u</sub>, Q<sub>s</sub>, Q<sub>m</sub>, and Q<sub>l</sub> refer to quantum catch estimates for UV-, short, medium-, and long-wavelength photoreceptors, respectively.</p>
<p>For a dichromatic example, we can model our floral reflectance data using the visual system of the domestic dog <em>Canis familiaris</em>, which has two cones with maximal sensitivity near 440 and 560 nm.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'canis'</span>)</a>
<a class="sourceLine" id="cb110-2" data-line-number="2"></a>
<a class="sourceLine" id="cb110-3" data-line-number="3">di.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'di'</span>)</a>
<a class="sourceLine" id="cb110-4" data-line-number="4"></a>
<a class="sourceLine" id="cb110-5" data-line-number="5"><span class="kw">head</span>(di.flowers)</a></code></pre></div>
<pre><code>##                                s         l           x      r.vec
## Goodenia_heterophylla 0.52954393 0.4704561 -0.04178143 0.04178143
## Goodenia_geniculata   0.25430150 0.7456985  0.34747015 0.34747015
## Goodenia_gracilis     0.01747832 0.9825217  0.68238870 0.68238870
## Xyris_operculata      0.39433933 0.6056607  0.14942675 0.14942675
## Eucalyptus_sp         0.40628552 0.5937145  0.13253229 0.13253229
## Faradaya_splendida    0.23166580 0.7683342  0.37948187 0.37948187</code></pre>
<p>The output contains values for the relative stimulation of shot- and long-wavelength sensitive photoreceptors associated with each flower, along with its single coordinate in dichromatic space and its r.vector (distance from the origin). To visualise where these points lie, we can simply plot them on a segment.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">plot</span>(di.flowers, <span class="dt">col =</span> flowercols) </a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-55-1.png" alt="_Flowers in a dichromatic colorspace, as modelled according to a canid visual system._" width="384"><p class="caption">
<em>Flowers in a dichromatic colorspace, as modelled according to a canid visual system.</em>
</p>
</div>
<p>For our trichromatic viewer we can use the honeybee <em>Apis mellifera</em>, one of the most significant and widespread pollinators. We’ll also transform our quantum catches according to Fechner’s law by specifying <code>qcatch = 'fi'</code>, and will model photoreceptor stimulation under bright conditions by scaling our illuminant with the <code>scale</code> argument.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'apis'</span>, <span class="dt">qcatch =</span> <span class="st">'fi'</span>, <span class="dt">scale =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb113-2" data-line-number="2"></a>
<a class="sourceLine" id="cb113-3" data-line-number="3">tri.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'tri'</span>)</a>
<a class="sourceLine" id="cb113-4" data-line-number="4"></a>
<a class="sourceLine" id="cb113-5" data-line-number="5"><span class="kw">head</span>(tri.flowers)</a></code></pre></div>
<pre><code>##                               s         m         l            x
## Goodenia_heterophylla 0.2882383 0.3587254 0.3530363 -0.004022828
## Goodenia_geniculata   0.2475326 0.3549832 0.3974842  0.030052720
## Goodenia_gracilis     0.1373117 0.3125304 0.5501579  0.168028001
## Xyris_operculata      0.2395035 0.3729820 0.3875145  0.010275990
## Eucalyptus_sp         0.2760091 0.3548096 0.3691813  0.010162377
## Faradaya_splendida    0.2654951 0.3431266 0.3913783  0.034119147
##                                 y    h.theta      r.vec
## Goodenia_heterophylla -0.05522995 -1.6435057 0.05537626
## Goodenia_geniculata   -0.10508396 -1.2922439 0.10929687
## Goodenia_gracilis     -0.24007647 -0.9601417 0.29303604
## Xyris_operculata      -0.11491764 -1.4816131 0.11537616
## Eucalyptus_sp         -0.07020755 -1.4270471 0.07093922
## Faradaya_splendida    -0.08308452 -1.1811377 0.08981733</code></pre>
<p>As in the case of our dichromat, the output contains relative photoreceptor stimulations, coordinates in the Maxwell triangle, a well as the ‘hue angle’ <code>h.theta</code> and distance from the origin (<code>r.vec</code>).</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">plot</span>(tri.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols) </a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-57-1.png" alt="_Floral reflectance in a Maxwell triangle, considering a honeybee visual system._" width="384"><p class="caption">
<em>Floral reflectance in a Maxwell triangle, considering a honeybee visual system.</em>
</p>
</div>
<p>Finally, we’ll draw on the blue tit’s visual system to model our floral reflectance spectra in a tetrahedral space, again using log-transformed quantum catches and assuming bright viewing conditions.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">"bluetit"</span>, <span class="dt">qcatch =</span> <span class="st">"fi"</span>, <span class="dt">scale =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb116-2" data-line-number="2"></a>
<a class="sourceLine" id="cb116-3" data-line-number="3">tetra.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">"tcs"</span>)</a>
<a class="sourceLine" id="cb116-4" data-line-number="4"></a>
<a class="sourceLine" id="cb116-5" data-line-number="5"><span class="kw">head</span>(tetra.flowers)</a></code></pre></div>
<pre><code>##                               u         s         m         l         u.r
## Goodenia_heterophylla 0.2274310 0.2659669 0.2524170 0.2541851 -0.02256897
## Goodenia_geniculata   0.1625182 0.2721621 0.2828016 0.2825182 -0.08748184
## Goodenia_gracilis     0.0428552 0.2443091 0.3504414 0.3623943 -0.20714480
## Xyris_operculata      0.1766234 0.2709785 0.2642637 0.2881344 -0.07337659
## Eucalyptus_sp         0.2118481 0.2609468 0.2637023 0.2635028 -0.03815190
## Faradaya_splendida    0.1844183 0.2557660 0.2786393 0.2811764 -0.06558169
##                                s.r         m.r         l.r            x
## Goodenia_heterophylla  0.015966893 0.002417012 0.004185066 -0.007214866
## Goodenia_geniculata    0.022162064 0.032801599 0.032518179  0.006341799
## Goodenia_gracilis     -0.005690920 0.100441373 0.112394348  0.072312163
## Xyris_operculata       0.020978454 0.014263689 0.038134446  0.010505857
## Eucalyptus_sp          0.010946788 0.013702317 0.013502794  0.001565228
## Faradaya_splendida     0.005765955 0.028639328 0.031176408  0.015560661
##                                  y           z    h.theta     h.phi
## Goodenia_heterophylla -0.005415708 -0.02256897 -2.4976873 -1.190529
## Goodenia_geniculata    0.003861848 -0.08748184  0.5469755 -1.486123
## Goodenia_gracilis      0.033297418 -0.20714480  0.4315247 -1.203879
## Xyris_operculata      -0.010813615 -0.07337659 -0.7998327 -1.368146
## Eucalyptus_sp          0.001044768 -0.03815190  0.5885699 -1.521510
## Faradaya_splendida     0.007189965 -0.06558169  0.4328380 -1.315140
##                            r.vec     r.max r.achieved
## Goodenia_heterophylla 0.02430520 0.2692325 0.09027589
## Goodenia_geniculata   0.08779638 0.2508989 0.34992737
## Goodenia_gracilis     0.22191605 0.2678272 0.82857920
## Xyris_operculata      0.07490949 0.2552227 0.29350636
## Eucalyptus_sp         0.03819828 0.2503039 0.15260760
## Faradaya_splendida    0.06778487 0.2583986 0.26232676</code></pre>
<p>Tetrahedral data (via <code><a href="../reference/colspace.html">colspace(space = 'tcs')</a></code>) may be visualised in an <em>interactive</em> plot by using <code>tcsplot</code>, along with the accessory functions <code>tcspoints</code> and <code>tcsvol</code> for adding points and convex hulls, respectively. As of version <code>1.0</code>, <code>pavo</code> also includes a <em>static</em> tetrahedral plot. As with other colorspace plots there are a number of associated graphical options, though the <code>theta</code> and <code>phi</code> arguments are particularly useful in this case, as they control the orientation (in degrees) of the tetrahedron in the xy and yz planes, respectively.</p>
<p>When plotting the tetrahedral colorspace, one can also force perspective by changing the size of points relative to their distance from the plane of observation, using the arguments <code>perspective = TRUE</code> and controling the size range with the <code>range</code> argument. Several other options control the appearance of this plot, you can check these using <code><a href="../reference/plot.colspace.html">?plot.colspace</a></code> or <code><a href="../reference/tetraplot.html">?tetraplot</a></code></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="kw">plot</span>(tetra.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols, <span class="dt">perspective =</span> <span class="ot">TRUE</span>, <span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">cex =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-59-1.png" alt="_Flowers in a tetrahedral colorspace modelled using the visual phenotype of the blue tit. Point size is used to force perspective_" width="480"><p class="caption">
<em>Flowers in a tetrahedral colorspace modelled using the visual phenotype of the blue tit. Point size is used to force perspective</em>
</p>
</div>
<p>Two additional functions may help with tetrahedral colorspace plotting:</p>
<ul>
<li>
<code>axistetra</code> function can be used to draw arrows showing the direction and magnitude of distortion of x, y and z in the tetrahedral plot.</li>
<li>
<code>legendtetra</code> allows you to add a legend to a plot.</li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">pty =</span> <span class="st">"s"</span>)</a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="kw">plot</span>(tetra.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols)</a>
<a class="sourceLine" id="cb119-3" data-line-number="3"><span class="kw"><a href="../reference/axistetra.html">axistetra</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">1.8</span>)</a>
<a class="sourceLine" id="cb119-4" data-line-number="4"><span class="kw">plot</span>(tetra.flowers, <span class="dt">theta =</span> <span class="dv">110</span>, <span class="dt">phi =</span> <span class="dv">10</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols)</a>
<a class="sourceLine" id="cb119-5" data-line-number="5"><span class="kw"><a href="../reference/axistetra.html">axistetra</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">1.8</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-60-1.png" alt="_Flowers in a tetrahedral colorspace, with varied orientations and perspectives, modelled using the visual phenotype of the blue tit._" width="576"><p class="caption">
<em>Flowers in a tetrahedral colorspace, with varied orientations and perspectives, modelled using the visual phenotype of the blue tit.</em>
</p>
</div>
<p>For tetrahedral models, another plotting option available is <code>projplot</code>, which projects color points in the surface of a sphere encompassing the tetrahedron. This plot is particularly useful to see differences in hue.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="kw"><a href="../reference/projplot.html">projplot</a></span>(tetra.flowers, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-61-1.png" alt="_Projection plot from a tetrahedral color space._" width="480"><p class="caption">
<em>Projection plot from a tetrahedral color space.</em>
</p>
</div>
<p>Finally, a useful function for tetrahedral models is <code>voloverlap</code>, which calculates the overlap in tetrahedral color volume between two sets of points. This can be useful to explore whether different species occupy similar (overlapping) or different (non- overlapping) “sensory niches”", or to test for mimetism, dichromatism, etc. (Stoddard &amp; Prum 2011). To show this function, we will use the <code>sicalis</code> dataset, which includes measurements from the crown (C), throat (T) and breast (B) of seven stripe-tailed yellow finches (<em>Sicalis citrina</em>).</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">data</span>(sicalis)</a></code></pre></div>
<p>We will use this dataset to test for the overlap between the volume determined by the measurements of those body parts from multiple individuals in the tetrahedral colorspace (note the option <code>plot</code> for plotting of the volumes:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">pty =</span> <span class="st">"s"</span>)</a>
<a class="sourceLine" id="cb122-2" data-line-number="2">tcs.sicalis.C &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="kw"><a href="../reference/colspace.html">colspace</a></span>(<span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sicalis)), <span class="st">"C"</span>)</a>
<a class="sourceLine" id="cb122-3" data-line-number="3">tcs.sicalis.T &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="kw"><a href="../reference/colspace.html">colspace</a></span>(<span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sicalis)), <span class="st">"T"</span>)</a>
<a class="sourceLine" id="cb122-4" data-line-number="4">tcs.sicalis.B &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="kw"><a href="../reference/colspace.html">colspace</a></span>(<span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sicalis)), <span class="st">"B"</span>)</a>
<a class="sourceLine" id="cb122-5" data-line-number="5"><span class="kw"><a href="../reference/voloverlap.html">voloverlap</a></span>(tcs.sicalis.T, tcs.sicalis.B, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##           vol1         vol2   overlapvol vsmallest      vboth
## 1 5.183721e-06 6.281511e-06 6.904074e-07 0.1331876 0.06407598</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="kw"><a href="../reference/voloverlap.html">voloverlap</a></span>(tcs.sicalis.T, tcs.sicalis.C, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##           vol1         vol2 overlapvol vsmallest vboth
## 1 5.183721e-06 4.739152e-06          0         0     0</code></pre>
<p><code>voverlap</code> gives the volume (<span class="math inline">\(V\)</span>) of the convex hull delimited by the overlap between the two original volumes, and two proportions are calculated from that: <span class="math display">\[V_{smallest} = V_{overlap} /
V_{smallest}\]</span> and <span class="math display">\[V_{both} = V_{overlap} / (V_A + V_B)\]</span>. Thus, if one of the volumes is entirely contained in the other, <code>vsmallest</code> will equal 1.</p>
<p>So we can clearly see that there is overlap between the throat and breast colors (of about 6%), but not between the throat and the crown colors (Figures below).</p>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-64-1.png" alt="_Volume overlap between male Stripe-Tailed Yellow Finch (_Sicalis citrina_) throat and breast (left) and throat and crown (right)._" width="576"><p class="caption">
<em>Volume overlap between male Stripe-Tailed Yellow Finch (<em>Sicalis citrina</em>) throat and breast (left) and throat and crown (right).</em>
</p>
</div>
<p><strong>Summary variables for groups of points</strong></p>
<p>Another advantage of colorspace models is that they allow for the calculation of useful summary statistics of groups of points, such as the centroid of the points, the total volume occupied, the mean and variance of hue span and the mean saturation. In <code>pavo</code>, the result of a <code>colspace</code> call is an object of class <code>colspace</code>, and thus these summary statistics can be calculated simply by calling <code>summary</code>. Note that the <code>summary</code> call can also take a <code>by</code> vector of group identities, so that the variables are calculated for each group separately:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw">summary</span>(tetra.flowers)</a></code></pre></div>
<pre><code>## Colorspace &amp; visual model options:
##  * Colorspace: tcs 
##  * Quantal catch: fi 
##  * Visual system, chromatic: bluetit 
##  * Visual system, achromatic: none 
##  * Illuminant: ideal, scale = 10000 (von Kries color correction not applied) 
##  * Background: ideal 
##  * Relative: TRUE 
## </code></pre>
<pre><code>##            centroid.u centroid.s centroid.m centroid.l        c.vol
## all.points  0.1948478  0.2554421  0.2704411   0.279269 0.0002510915
##              rel.c.vol  colspan.m   colspan.v huedisp.m huedisp.v
## all.points 0.001159742 0.05706825 0.001682224 0.6413439 0.3157949
##              mean.ra    max.ra
## all.points 0.2428508 0.8285792</code></pre>
</div>
<div id="the-color-hexagon" class="section level4">
<h4 class="hasAnchor">
<a href="#the-color-hexagon" class="anchor"></a>The Color Hexagon</h4>
<p>The hexagon color space of Chittka (1992) is a generalised color-opponent model of hymenopteran vision that has found extremely broad use, particularly in studies of bee-flower interactions. It’s also often broadly applied across hymenopteran species, because the photopigments underlying trichromatic vision in Hymenoptera appear to be quite conserved (Briscoe &amp; Chittka 2001). What’s particularly useful is that color distances within the hexagon have been extensively validated against behaviour, and thus offer a relatively reliable measure of perceptual distance.</p>
<p>In the hexagon, photoreceptor quantum catches are typically hyperbolically transformed (and <code>pavo</code> will return a warning if the transform is not selected), and vonkries correction is often used used to model photoreceptor adaptation to a vegetation background. This can all now be specified in <code>vismodel</code>. including the optional use of a ‘green’ vegetation background. Note that although this is a colorspace model, we specific <code>relative = FALSE</code> to return raw (albeit transformed) quantum catches, as required for the model.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'apis'</span>, <span class="dt">qcatch =</span> <span class="st">'Ei'</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">achro =</span> <span class="st">'l'</span>, <span class="dt">bkg =</span> <span class="st">'green'</span>)</a></code></pre></div>
<p>We can then apply the hexagon model in <code>colspace</code>, which will convert our photoreceptor ‘excitation values’ to coordinates in the hexagon according to:</p>
<p><span class="math display">\[x = \frac{\sqrt{3}}{2(E_g + E_{uv})}\]</span></p>
<p><span class="math display">\[y = E_b - 0.5(E_{uv} + E_g)\]</span></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">hex.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'hexagon'</span>)</a>
<a class="sourceLine" id="cb130-2" data-line-number="2"></a>
<a class="sourceLine" id="cb130-3" data-line-number="3"><span class="kw">head</span>(hex.flowers)</a></code></pre></div>
<pre><code>##                                s         m         l         x          y
## Goodenia_heterophylla 0.56572097 0.8237141 0.7053057 0.1208839  0.1882007
## Goodenia_geniculata   0.35761236 0.8176153 0.8670134 0.4411542  0.2053024
## Goodenia_gracilis     0.01888788 0.1622766 0.7810589 0.6600594 -0.2376968
## Xyris_operculata      0.21080752 0.7345122 0.6796464 0.4060263  0.2892853
## Eucalyptus_sp         0.55622758 0.8515289 0.8208038 0.2291297  0.1630132
## Faradaya_splendida    0.45855056 0.7828905 0.8565895 0.3447118  0.1253205
##                         h.theta     r.vec sec.fine sec.coarse       lum
## Goodenia_heterophylla  32.71320 0.2236793       30  bluegreen 0.1680153
## Goodenia_geniculata    65.04388 0.4865862       60  bluegreen 0.3548825
## Goodenia_gracilis     109.80467 0.7015541      100      green 0.2313678
## Xyris_operculata       54.53092 0.4985412       50  bluegreen 0.1518319
## Eucalyptus_sp          54.57024 0.2812005       50  bluegreen 0.2787543
## Faradaya_splendida     70.02119 0.3667853       70  bluegreen 0.3351008</code></pre>
<p>Again, the output includes the photoreceptor excitation values for short- medium- and long-wave sensitive photoreceptors, x and y coordinates, and measures of hue and saturation for each stimulus. The hegaon model also outputs two additional measures of of subjective ‘bee-hue’; <code>sec.fine</code> and <code>sec.coarse</code>. <code>sec.fine</code> describes the location of stimuli within one of 36 ‘hue sectors’ that are specified by radially dissecting the hexagon in 10-degree increments. <code>sec.coarse</code> follows a similar principle, though here the hexagon is divided into only five ‘bee-hue’ sectors: UV, UV-blue, blue, blue-green, green, and UV-green. These can easily be visualised by specifying <code>sectors = 'coarse</code> or <code>sectors = 'fine'</code> in a call to <code>plot</code> after modelling.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="kw">plot</span>(hex.flowers, <span class="dt">sectors =</span> <span class="st">'coarse'</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-68-1.png" alt="_Flowers as modelled in the hymenopteran color hexagon of Chittka (1992), overlain with coarse bee-hue sectors._" width="480"><p class="caption">
<em>Flowers as modelled in the hymenopteran color hexagon of Chittka (1992), overlain with coarse bee-hue sectors.</em>
</p>
</div>
</div>
<div id="the-color-opponent-coding-coc-space" class="section level4">
<h4 class="hasAnchor">
<a href="#the-color-opponent-coding-coc-space" class="anchor"></a>The Color Opponent Coding (COC) Space</h4>
<p>The color opponent coding (coc) space is an earlier hymenopteran visual model (Backhaus 1991) which, although now seldom used in favour of the hexagon, may prove useful for comparative work. While the initial estimation of photoreceptor excitation is similar to that in the hexagon, the coc subsequently specifies <code>A</code> and <code>B</code> coordinates based on empirically-derived weights for the output from each photoreceptor:</p>
<p><span class="math display">\[A = -9.86E_g + 7.70E_b + 2.16E_g\]</span> <span class="math display">\[B = -5.17E_g + 20.25E_b - 15.08E_g\]</span></p>
<p>Where E<sub>i</sub> is the excitation value (quantum catch) in photoreceptor <em>i</em>.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">"apis"</span>, <span class="dt">qcatch =</span> <span class="st">"Ei"</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">bkg =</span> <span class="st">"green"</span>)</a>
<a class="sourceLine" id="cb133-2" data-line-number="2"></a>
<a class="sourceLine" id="cb133-3" data-line-number="3">coc.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">"coc"</span>)</a>
<a class="sourceLine" id="cb133-4" data-line-number="4"></a>
<a class="sourceLine" id="cb133-5" data-line-number="5"><span class="kw">head</span>(coc.flowers)</a></code></pre></div>
<pre><code>##                                s         m         l        x          y
## Goodenia_heterophylla 0.56572097 0.8237141 0.7053057 2.288050  3.1194224
## Goodenia_geniculata   0.35761236 0.8176153 0.8670134 4.642329  1.6332926
## Goodenia_gracilis     0.01888788 0.1622766 0.7810589 2.750382 -8.5899171
## Xyris_operculata      0.21080752 0.7345122 0.6796464 5.045218  3.5349309
## Eucalyptus_sp         0.55622758 0.8515289 0.8208038 2.845304  1.9900420
## Faradaya_splendida    0.45855056 0.7828905 0.8565895 3.357182  0.5654568
##                           r.vec
## Goodenia_heterophylla  5.407473
## Goodenia_geniculata    6.275622
## Goodenia_gracilis     11.340299
## Xyris_operculata       8.580149
## Eucalyptus_sp          4.835346
## Faradaya_splendida     3.922638</code></pre>
<p>The A and B coordinates are designated x and y in the output of coc for consistency, and while the model includes a measure of saturation in <code>r.vec</code>, it contains no associated measure of hue.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">plot</span>(coc.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols, <span class="dt">yaxt =</span> <span class="st">"n"</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-70-1.png" alt="_Flowers in the color-opponent-coding space of Backhaus (1991), as modelling according to the honeybee._" width="480"><p class="caption">
<em>Flowers in the color-opponent-coding space of Backhaus (1991), as modelling according to the honeybee.</em>
</p>
</div>
</div>
<div id="cie-spaces" class="section level4">
<h4 class="hasAnchor">
<a href="#cie-spaces" class="anchor"></a>CIE Spaces</h4>
<p>The CIE (International Commission on Illumination) colorspaces are a suite of models of human color vision and perception. <code>pavo 1.0</code> now includes two of the most commonly used: the foundational 1931 CIE XYZ space, and the more modern, perceptually calibrated CIE LAB space and its cylindrical CIE LCh transformation. Tristimulus values in XYZ space are calculated as:</p>
<p><span class="math display">\[X = k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{x}(\lambda)d\lambda}\]</span> <span class="math display">\[Y = k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{y}(\lambda)d\lambda}\]</span> <span class="math display">\[Z = k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{z}(\lambda)d\lambda}\]</span></p>
<p>where <em>x</em>, <em>y</em>, and <em>z</em> are the trichromatic color matching functions for a ‘standard colorimetric viewer’. These functions are designed to describe an average human’s chromatic response within a specified viewing arc in the fovea (to account for the uneven distribution of cones across eye). <code>pavo</code> includes both the CIE 2-degree and the modern 10-degree standard observer, which can be selected in the <code>visual</code> option in the <code>vismodel</code> function. In these equations, k is the normalising factor</p>
<p><span class="math display">\[k = \frac{100}{\int_{300}^{700}{I(\lambda)\bar{y}(\lambda)d\lambda}}\]</span></p>
<p>and the chromaticity coordinates of stimuli are calculated as</p>
<p><span class="math display">\[x = \frac{X}{X + Y + Z}\]</span> <span class="math display">\[y = \frac{Y}{X + Y + Z}\]</span> <span class="math display">\[z = \frac{Z}{X + Y + Z} = 1 - x - y\]</span></p>
<p>For modelling in both XYZ and LAB spaces, here we’ll use the CIE 10-degree standard observer, and assume a <code>D65</code> ‘standard daylight’ illuminant. Again, although they are colorspace models, we need to set <code>relative = FALSE</code> to return raw quantum catch estimates, <code>vonkries = TRUE</code> to account for the required normalising factor (as above), and <code>achromatic = 'none'</code> since there is no applicable way to estimate luminance in the CIE models. As with all models that have particular requirements, <code>vismodel</code> will output warnings and/or errors if unusual or non-standard arguments are specified.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'cie10'</span>, <span class="dt">illum =</span> <span class="st">'D65'</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">achromatic =</span> <span class="st">'none'</span>)</a></code></pre></div>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1">ciexyz.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'ciexyz'</span>)</a>
<a class="sourceLine" id="cb137-2" data-line-number="2"><span class="kw">head</span>(ciexyz.flowers)</a></code></pre></div>
<pre><code>##                               X         Y         Z         x         y
## Goodenia_heterophylla 0.2074305 0.2067084 0.3013614 0.2899097 0.2889005
## Goodenia_geniculata   0.6472803 0.6752456 0.4240380 0.3706021 0.3866137
## Goodenia_gracilis     0.5153064 0.4587957 0.0153714 0.5207885 0.4636766
## Xyris_operculata      0.2884446 0.2353124 0.2224271 0.3865595 0.3153544
## Eucalyptus_sp         0.4431842 0.4470468 0.4019893 0.3429634 0.3459524
## Faradaya_splendida    0.6636975 0.6553481 0.2869075 0.4132733 0.4080743
##                                z
## Goodenia_heterophylla 0.42118974
## Goodenia_geniculata   0.24278414
## Goodenia_gracilis     0.01553492
## Xyris_operculata      0.29808613
## Eucalyptus_sp         0.31108420
## Faradaya_splendida    0.17865248</code></pre>
<p>The output is simply the tristimulus values and chromaticity coordinates of stimuli, and we can visualise our results (along with a line connecting monochromatic loci, by default) by calling</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="kw">plot</span>(ciexyz.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols) </a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-73-1.png" alt="_Floral reflectance in the CIEXYZ human visual model. Note that this space is not perceptually calibrated, so we cannot make inferences about the similarity or differences of colors based on their relative location._" width="480"><p class="caption">
<em>Floral reflectance in the CIEXYZ human visual model. Note that this space is not perceptually calibrated, so we cannot make inferences about the similarity or differences of colors based on their relative location.</em>
</p>
</div>
<p>The <code>Lab</code> space is a more recent development, and is a color-opponent model that attempts to mimic the nonlinear responses of the human eye. The <code>Lab</code> space is also calibrated (unlike the <code>XYZ</code> space) such that Euclidean distances between points represent relative perceptual distances. This means that two stimuli that are farther apart in <code>Lab</code> space should be <em>percieved</em> as more different that two closer points. As the name suggests, the dimensions of the <code>Lab</code> space are <em>L</em>ightness (i.e. subjective brightness), along with two color-opponent dimensions designated <em>a</em> and <em>b</em>. The <code>colspace</code> function, when <code>space = cielab</code>, simply converts points from the <code>XYZ</code> model according to:</p>
<p><span class="math display">\[L = 116\left(\frac{Y}{Y_n}\right)^\frac{1}{3} \;\; if \;\; \frac{Y}{Y_n} &gt; 0.008856\]</span> <span class="math display">\[L = 903.3\left(\frac{Y}{Y_n}\right) \;\; if \;\; \frac{Y}{Y_n} \leq 0.008856\]</span></p>
<p><span class="math display">\[a = 500\left(f\left(\frac{X}{X_n}\right) - f\left(\frac{Y}{Y_n}\right)\right)\]</span></p>
<p><span class="math display">\[b = 500\left(f\left(\frac{Y}{Y_n}\right) - f\left(\frac{Z}{Z_n}\right)\right)\]</span></p>
<p>where</p>
<p><span class="math display">\[f(x) = x^\frac{1}{3} \;\; if \;\; x &gt; 0.008856\]</span> <span class="math display">\[f(x) = 7.787(x) + \frac{16}{116} \;\; if \;\; x \leq 0.008856\]</span></p>
<p>Here, <span class="math inline">\(X_n, Y_n, Z_n\)</span> are neutral point values to model visual adaptation, calculated as:</p>
<p><span class="math display">\[X_n = \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{x}(\lambda)d\lambda}\]</span> <span class="math display">\[Y_n = \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{y}(\lambda)d\lambda}\]</span> <span class="math display">\[Z_n = \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{z}(\lambda)d\lambda}\]</span></p>
<p>when <span class="math inline">\(R_n(\lambda)\)</span> is a perfect diffuse reflector (i.e. 1).</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">cielab.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'cielab'</span>)</a>
<a class="sourceLine" id="cb140-2" data-line-number="2"><span class="kw">head</span>(cielab.flowers)</a></code></pre></div>
<pre><code>##                               X         Y         Z        L           a
## Goodenia_heterophylla 0.2074305 0.2067084 0.3013614 16.91253  0.91908831
## Goodenia_geniculata   0.6472803 0.6752456 0.4240380 55.24744 -7.78898966
## Goodenia_gracilis     0.5153064 0.4587957 0.0153714 37.53788 21.57990123
## Xyris_operculata      0.2884446 0.2353124 0.2224271 19.25286 19.66170677
## Eucalyptus_sp         0.4431842 0.4470468 0.4019893 36.57660  0.05744138
## Faradaya_splendida    0.6636975 0.6553481 0.2869075 53.61946  5.07048199
##                                b
## Goodenia_heterophylla -24.336189
## Goodenia_geniculata    19.981497
## Goodenia_gracilis      61.991586
## Xyris_operculata       -6.289287
## Eucalyptus_sp          -8.295538
## Faradaya_splendida     41.517115</code></pre>
<p>Our output now contains the tristimulus <code>XYZ</code> values, as well as their <code>Lab</code> counterparts, which are coordinates in the <code>Lab</code> space. These can also be visualised in three-dimensional <code>Lab</code> space by calling <code>plot</code>:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="kw">plot</span>(cielab.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols) </a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-75-1.png" alt="_CIELAB._" width="480"><p class="caption">
<em>CIELAB.</em>
</p>
</div>
</div>
<div id="categorical-fly-colorspace" class="section level4">
<h4 class="hasAnchor">
<a href="#categorical-fly-colorspace" class="anchor"></a>Categorical Fly Colorspace</h4>
<p>The categorical color vision model of Troje (1993) is a model of dipteran vision, based on behavioural data from the blowfly <em>Lucilia</em> sp. It assumes the involvement of all four dipteran photoreceptor classes (R7 &amp; R8 ‘pale’ and ‘yellow’ subtypes), and further posits that color vision is based on two specific opponent mechanisms (R7p - R8p, and R7y - R8y). The model assumes that all colors are perceptually grouped into one of four color categories, and that flies are unable to distinguish between colors that fall within the same category.</p>
<p>We’ll use the visual systems of the mudcoid fly <em>Musca domestica</em>, and will begin by estimating linear (i.e. untransformed) quantum catches for each of the four photoreceptors.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">qcatch =</span> <span class="st">'Qi'</span>, <span class="dt">visual =</span> <span class="st">'musca'</span>, <span class="dt">achro =</span> <span class="st">'none'</span>, <span class="dt">relative =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Our call to <code>colspace</code> will then simply estimate the location of stimuli in the categorical space as the difference in relative stimulation between ‘pale’ (R7p - R8p) and ‘yellow’ (R7y - R8y) photoreceptor pairs:</p>
<p><span class="math display">\[x = R7_p - R8_p\]</span></p>
<p><span class="math display">\[y = R7_y - R8_y\]</span></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1">cat.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'categorical'</span>)</a>
<a class="sourceLine" id="cb144-2" data-line-number="2"></a>
<a class="sourceLine" id="cb144-3" data-line-number="3"><span class="kw">head</span>(cat.flowers)</a></code></pre></div>
<pre><code>##                              R7p        R7y       R8p       R8y          x
## Goodenia_heterophylla 0.05387620 0.18710675 0.4335989 0.3254182 -0.3797227
## Goodenia_geniculata   0.02080100 0.08276037 0.3737596 0.5226791 -0.3529586
## Goodenia_gracilis     0.01153133 0.02501422 0.1420052 0.8214492 -0.1304739
## Xyris_operculata      0.01270355 0.12523436 0.4488383 0.4132238 -0.4361348
## Eucalyptus_sp         0.03461951 0.14207857 0.3977211 0.4255808 -0.3631016
## Faradaya_splendida    0.03599956 0.09188569 0.3129199 0.5591949 -0.2769203
##                                y category     r.vec
## Goodenia_heterophylla -0.1383114     p-y- 0.4041279
## Goodenia_geniculata   -0.4399187     p-y- 0.5640108
## Goodenia_gracilis     -0.7964350     p-y- 0.8070515
## Xyris_operculata      -0.2879894     p-y- 0.5226389
## Eucalyptus_sp         -0.2835023     p-y- 0.4606694
## Faradaya_splendida    -0.4673092     p-y- 0.5431968</code></pre>
<p>And it is simply the signs of these differences that define the four possible fly-color categories (p+y+, p-y+, p+y-, p-y-), which we can see in the associated plot.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="kw">plot</span>(cat.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> flowercols) </a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-78-1.png" alt="_Flowers in the categorical colorspace of Troje (1993)._" width="480"><p class="caption">
<em>Flowers in the categorical colorspace of Troje (1993).</em>
</p>
</div>
</div>
<div id="segment-classification" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-classification" class="anchor"></a>Segment Classification</h4>
<p>The segment classification analysis (Endler 1990) does not assume any particular visual system, but instead tries to classify colors in a manner that captures common properties of many vertebrate (and some invertebrate) visual systems. In essence, it breaks down the reflectance spectrum region of interest into four equally-spaced regions, measuring the relative signal along those regions. This approximates a tetrachromatic system with ultraviolet, short, medium, and long-wavelength sensitive photoreceptors.</p>
<p>Though somewhat simplistic, this model captures many of the properties of other, more complex visual models, but without many of the additional assumptions these make. It also provides results in a fairly intuitive color space, in which the angle corresponds to hue and the distance from the center corresponds to chroma (Figure below; in fact, variables <code>S5</code> and <code>H4</code> from <code>summary.rspec</code> are calculated from these relative segments). Note that, while a segment analysis ranging from 300 or 400 nm to 700 nm corresponds quite closely to the human visual system color wheel, any wavelength range can be analyzed in this way, returning a 360<sup>o</sup> hue space delimited by the range used.</p>
<p>The segment differences or “opponents” are calculated as:</p>
<p><span class="math display">\[LM = \frac{ R_\lambda \sum_{\lambda={Q4}} R_\lambda - \sum_{\lambda={Q2}} R_\lambda }{\sum_{\lambda={min}}^{max}R_\lambda}\]</span> <span class="math display">\[MS = \frac{ R_\lambda \sum_{\lambda={Q3}} R_\lambda - \sum_{\lambda={Q1}} R_\lambda }{\sum_{\lambda={min}}^{max}R_\lambda}\]</span></p>
<p>Where <span class="math inline">\(Qi\)</span> represent the interquantile distances (e.g. <span class="math inline">\(Q_1=ultraviolet\)</span>, <span class="math inline">\(Q_2=blue\)</span>, <span class="math inline">\(Q_3=green\)</span> and <span class="math inline">\(Q_4=red\)</span>)</p>
<p>The segment classification model is obtained through the <code><a href="../reference/colspace.html">colspace()</a></code> argument <code>space = 'segment'</code>, following initial modelling with <code><a href="../reference/vismodel.html">vismodel()</a></code>. The example below uses idealized reflectance spectra to illustrate how the avian color space defined from the segment classification maps to the human color wheel:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">fakedata1 &lt;-<span class="st"> </span><span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb147-2" data-line-number="2">  <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dt">by =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb147-3" data-line-number="3">  <span class="cf">function</span>(x) <span class="kw">rowSums</span>(<span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb147-4" data-line-number="4">      <span class="kw">dnorm</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb147-5" data-line-number="5">      <span class="kw">dnorm</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x <span class="op">+</span><span class="st"> </span><span class="dv">400</span>, <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb147-6" data-line-number="6">    ))</a>
<a class="sourceLine" id="cb147-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb147-8" data-line-number="8"></a>
<a class="sourceLine" id="cb147-9" data-line-number="9"><span class="co"># creating idealized specs with varying saturation</span></a>
<a class="sourceLine" id="cb147-10" data-line-number="10">fakedata2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb147-11" data-line-number="11">  <span class="kw">c</span>(<span class="dv">500</span>, <span class="dv">300</span>, <span class="dv">150</span>, <span class="dv">105</span>, <span class="dv">75</span>, <span class="dv">55</span>, <span class="dv">40</span>, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb147-12" data-line-number="12">  <span class="cf">function</span>(x) <span class="kw">dnorm</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="dv">550</span>, x)</a>
<a class="sourceLine" id="cb147-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb147-14" data-line-number="14"></a>
<a class="sourceLine" id="cb147-15" data-line-number="15">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw">data.frame</span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1))</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata1, <span class="st">"max"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a maximum value of 1</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw">data.frame</span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata2))</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"sum"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a total area of 1</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"min"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a minimum value of zero</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1"><span class="co"># converting reflectance to percentage</span></a>
<a class="sourceLine" id="cb157-2" data-line-number="2">fakedata1[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata1[, <span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb157-3" data-line-number="3">fakedata2[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata2[, <span class="dv">-1</span>] <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(fakedata2[, <span class="dv">-1</span>]) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb157-4" data-line-number="4"></a>
<a class="sourceLine" id="cb157-5" data-line-number="5"><span class="co"># combining and converting to rspec</span></a>
<a class="sourceLine" id="cb157-6" data-line-number="6">fakedata.c &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1[, <span class="dv">-1</span>], fakedata2[, <span class="dv">-1</span>])</a>
<a class="sourceLine" id="cb157-7" data-line-number="7">fakedata.c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedata.c)</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="co"># segment classification analysis</span></a>
<a class="sourceLine" id="cb159-2" data-line-number="2">seg.vis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(fakedata.c, <span class="dt">visual =</span> <span class="st">"segment"</span>, <span class="dt">achromatic =</span> <span class="st">"all"</span>)</a>
<a class="sourceLine" id="cb159-3" data-line-number="3">seg.fdc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(seg.vis, <span class="dt">space =</span> <span class="st">"segment"</span>)</a>
<a class="sourceLine" id="cb159-4" data-line-number="4"></a>
<a class="sourceLine" id="cb159-5" data-line-number="5"><span class="co"># plot results</span></a>
<a class="sourceLine" id="cb159-6" data-line-number="6"><span class="kw">plot</span>(seg.fdc, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(fakedata.c))</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-79-1.png" alt="_Idealized reflectance spectra and their projection on the axes of segment classification_" width="384"><p class="caption">
<em>Idealized reflectance spectra and their projection on the axes of segment classification</em>
</p>
</div>
</div>
<div id="colorspace-distances-with-coldist" class="section level4">
<h4 class="hasAnchor">
<a href="#colorspace-distances-with-coldist" class="anchor"></a>Colorspace Distances with <code>coldist</code>
</h4>
<p>Under the color space framework, color distances can be calculated simply as Euclidean distances of the relative cone stimulation data, either log-transformed or not, depending on how it was defined. However, these distances cannot be interpreted in terms of JNDs, since no receptor noise is incorporated in the model. Euclidean distances can be computed in <code>R</code> using the <code>coldist</code> function on the <code>colspace</code> output:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="kw">head</span>(<span class="kw"><a href="../reference/coldist.html">coldist</a></span>(tetra.flowers))</a></code></pre></div>
<p>Specialised colorspace models such as the colour-hexagon, coc space, CIELAB and CIELCH models have their own distance measures, which are returned be default when run through coldist(). Be sure to read the <code><a href="../reference/coldist.html">?coldist</a></code> documentation, and the original publications, to understand what is being returned. As an example, if we run the results of colour-hexagon modelling through <code>coldist</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="co"># Model flower colours according to a honeybee</span></a>
<a class="sourceLine" id="cb161-2" data-line-number="2">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">"apis"</span>, <span class="dt">qcatch =</span> <span class="st">"Ei"</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">achro =</span> <span class="st">"l"</span>, <span class="dt">bkg =</span> <span class="st">"green"</span>)</a>
<a class="sourceLine" id="cb161-3" data-line-number="3">hex.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">"hexagon"</span>)</a>
<a class="sourceLine" id="cb161-4" data-line-number="4"></a>
<a class="sourceLine" id="cb161-5" data-line-number="5"><span class="co"># Estimate color distances. No need to specify relative receptor densities, noise etc.,</span></a>
<a class="sourceLine" id="cb161-6" data-line-number="6"><span class="co"># which only apply in the case of receptor-noise modelling</span></a>
<a class="sourceLine" id="cb161-7" data-line-number="7">dist.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(hex.flowers)</a>
<a class="sourceLine" id="cb161-8" data-line-number="8"><span class="kw">head</span>(dist.flowers)</a></code></pre></div>
<pre><code>##                  patch1              patch2        dS
## 1 Goodenia_heterophylla Goodenia_geniculata 0.3207265
## 2 Goodenia_heterophylla   Goodenia_gracilis 0.6870945
## 3 Goodenia_heterophylla    Xyris_operculata 0.3025298
## 4 Goodenia_heterophylla       Eucalyptus_sp 0.1111375
## 5 Goodenia_heterophylla  Faradaya_splendida 0.2324927
## 6 Goodenia_heterophylla  Gaultheria_hispida 0.2280836</code></pre>
<p>the chromatic constrasts <code>dS</code> and achromatic contrasts <code>dL</code> are expressed as Euclidean distances in the hexagon, known as ‘hexagon units’ (Chittka 1992). If we had instead used the color-oppoonent coding space the units would have been city-bloc distances, while in the CIELAB model the distances would be derived from the CIE colour-distance formula (2000).</p>
</div>
<div id="distances-in-n-dimensions" class="section level4">
<h4 class="hasAnchor">
<a href="#distances-in-n-dimensions" class="anchor"></a>Distances in N-Dimensions</h4>
<p>The <code>codist</code> function is no longer limited to di-, tri- or tetrachromatic visual systems. The function has been generalised, and can now calculate color distances for n-dimensional visual phenotypes. This means there is no limit on the dimensionality of visual systems that may be input, which may prove useful for modelling nature’s extremes (e.g. butterflies, mantis shrimp) or for simulation-based work. Naturally, since these calculations aren’t largely implemented elsewhere, we recommend caution and validation of results prior to publication.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1"><span class="co"># Create an arbitrary visual phenotype with 10 photoreceptors</span></a>
<a class="sourceLine" id="cb163-2" data-line-number="2">fakemantisshrimp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensmodel.html">sensmodel</a></span>(<span class="kw">c</span>(<span class="dv">325</span>, <span class="dv">350</span>, <span class="dv">400</span>, <span class="dv">425</span>, <span class="dv">450</span>, <span class="dv">500</span>, <span class="dv">550</span>, <span class="dv">600</span>, <span class="dv">650</span>, <span class="dv">700</span>), <span class="dt">beta =</span> <span class="ot">FALSE</span>, <span class="dt">integrate =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb163-3" data-line-number="3"></a>
<a class="sourceLine" id="cb163-4" data-line-number="4"><span class="co"># Convert to percentages, just to color the plot</span></a>
<a class="sourceLine" id="cb163-5" data-line-number="5">fakemantisshrimp.colors &lt;-<span class="st"> </span>fakemantisshrimp <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb163-6" data-line-number="6">fakemantisshrimp.colors[, <span class="st">"wl"</span>] &lt;-<span class="st"> </span>fakemantisshrimp[, <span class="st">"wl"</span>]</a>
<a class="sourceLine" id="cb163-7" data-line-number="7"></a>
<a class="sourceLine" id="cb163-8" data-line-number="8"><span class="kw">plot</span>(fakemantisshrimp, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(fakemantisshrimp.colors), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">ylab =</span> <span class="st">"Absorbance"</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-82-1.png" alt="_Visual system of a pretend mantis shrimp with 10 cones_" width="384"><p class="caption">
<em>Visual system of a pretend mantis shrimp with 10 cones</em>
</p>
</div>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="co"># Run visual model and calculate color distances</span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2">vm.fms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> fakemantisshrimp, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">achro =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb164-3" data-line-number="3"></a>
<a class="sourceLine" id="cb164-4" data-line-number="4">JND.fms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vm.fms, <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb164-5" data-line-number="5"></a>
<a class="sourceLine" id="cb164-6" data-line-number="6"><span class="kw">head</span>(JND.fms)</a></code></pre></div>
<pre><code>##                  patch1              patch2        dS
## 1 Goodenia_heterophylla Goodenia_geniculata 16.297557
## 2 Goodenia_heterophylla   Goodenia_gracilis 48.390309
## 3 Goodenia_heterophylla    Xyris_operculata 30.760482
## 4 Goodenia_heterophylla       Eucalyptus_sp  6.044184
## 5 Goodenia_heterophylla  Faradaya_splendida 15.901435
## 6 Goodenia_heterophylla  Gaultheria_hispida 11.188246</code></pre>
</div>
</div>
</div>
</div>
<div id="organizing-spatial-image-data" class="section level1">
<h1 class="hasAnchor">
<a href="#organizing-spatial-image-data" class="anchor"></a>Organizing Spatial (image) Data</h1>
<p>We first import our images with <code>getimg</code>, which functions in a similar manner to <code>getspec</code>. Since we are importing more than one image, we can simply point the funtion to the folder containing the images, and it will use parallel processing (where possible) to import any jpg, bmp, or png images in the folder.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">butterflies &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getimg.html">getimg</a></span>(<span class="st">"~/pavo/vignette_data/images/"</span>)</a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="co"># 2  files found; importing images</span></a>
<a class="sourceLine" id="cb166-3" data-line-number="3"><span class="co"># |================================================================================| 100%, ETA 00:00</span></a></code></pre></div>
<p>When <code>pavo</code> imports imges, it created a multidimensional object of class <code>rimg</code>, which inherits from the <code>array</code> class. If more than one image is imported, then these <code>rimg</code> objects are stored as elements in a list. All image-based functions in <code>pavo</code> are capable of working with such <code>rimg</code> lists, which allows for a more convenient and tidy high-throughput workflow. Note that while <code>pavo</code> will allow you to load, manipulate, and analyse as many images as your computer’s memory allows, it will throw a message if the total size of images in memory is greater than ca. 200mb, as this will result in noticeably slowed performance (everything will still work, it will just be slow). This may be ameliorated by reducing the size of individual images, such as through <code><a href="../reference/procimg.html">procimg()</a></code>, or by processing images in smaller batches. All <code>rimg</code> objects have a number of identifying attributes, drawn on by image-processing functions, which can be readily inspected.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="kw"><a href="../reference/as.rimg.html">is.rimg</a></span>(butterflies)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="kw">str</span>(butterflies[[<span class="dv">1</span>]])</a></code></pre></div>
<pre><code>##  'rimg' num [1:500, 1:340, 1:3] 1 1 1 1 1 1 1 1 1 1 ...
##  - attr(*, "state")= chr "raw"
##  - attr(*, "imgname")= chr "h_melpomene"
##  - attr(*, "px_scale")= logi NA
##  - attr(*, "raw_scale")= logi NA
##  - attr(*, "k")= logi NA
##  - attr(*, "outline")= logi NA
##  - attr(*, "colnames")= logi NA
##  - attr(*, "tag_loc")= logi NA</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="kw">str</span>(butterflies[[<span class="dv">2</span>]])</a></code></pre></div>
<pre><code>##  'rimg' num [1:500, 1:398, 1:3] 1 1 1 1 1 1 1 1 1 1 ...
##  - attr(*, "state")= chr "raw"
##  - attr(*, "imgname")= chr "papilio"
##  - attr(*, "px_scale")= logi NA
##  - attr(*, "raw_scale")= logi NA
##  - attr(*, "k")= logi NA
##  - attr(*, "outline")= logi NA
##  - attr(*, "colnames")= logi NA
##  - attr(*, "tag_loc")= logi NA</code></pre>
<p>If you already have images loaded into R, you can convert them to <code>rimg</code> objects using <code>as.rimg</code>. The function will attempt to interpret a multidimensional array as an RGB image with values ranging between [0, 1], and imbue it with the custom attributes of an <code>rimg</code>. We can see this by creating a fake array, before converting it.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1">fakeimg &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">c</span>(</a>
<a class="sourceLine" id="cb173-2" data-line-number="2">  <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">12</span>, <span class="dt">ncol =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb173-3" data-line-number="3">  <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">12</span>, <span class="dt">ncol =</span> <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb173-4" data-line-number="4">  <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">12</span>, <span class="dt">ncol =</span> <span class="dv">8</span>)),</a>
<a class="sourceLine" id="cb173-5" data-line-number="5">  <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb173-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb173-7" data-line-number="7">fake_rimg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rimg.html">as.rimg</a></span>(fakeimg)</a>
<a class="sourceLine" id="cb173-8" data-line-number="8"><span class="kw"><a href="../reference/as.rimg.html">is.rimg</a></span>(fake_rimg)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="kw">str</span>(fake_rimg)</a></code></pre></div>
<pre><code>##  'rimg' num [1:12, 1:8, 1:3] 1 1 0 0 1 1 0 0 1 1 ...
##  - attr(*, "state")= chr "raw"
##  - attr(*, "imgname")= chr "img"
##  - attr(*, "px_scale")= logi NA
##  - attr(*, "raw_scale")= logi NA
##  - attr(*, "k")= logi NA
##  - attr(*, "outline")= logi NA
##  - attr(*, "colnames")= logi NA
##  - attr(*, "tag_loc")= logi NA</code></pre>
</div>
<div id="visualising-image-data" class="section level1">
<h1 class="hasAnchor">
<a href="#visualising-image-data" class="anchor"></a>Visualising Image Data</h1>
<div id="the-plot-and-summary-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#the-plot-and-summary-functions" class="anchor"></a>The <code>plot</code> and <code>summary</code> Functions</h2>
<p>Thanks to the underlying class system of <code>pavo</code>, the generic functions <code>plot</code> and <code>summary</code> recognise and respond to image-data in an appropriate manner, as is the case with spectral data. A quick call to <code>plot</code>, for example, prints our images. Note that while we call our images individually below (for convenient printing in the vignette), we could simply feed the entire list of images to <code>plot</code> and it would automatically step through each image in the list upon user input.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="co"># Note the plot titles are taken from the file names, and can be overridden.</span></a>
<a class="sourceLine" id="cb177-2" data-line-number="2"><span class="kw">plot</span>(butterflies[[<span class="dv">1</span>]])</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-87-1.png" alt="_Raw images of our butterflies_" width="384"><p class="caption">
<em>Raw images of our butterflies</em>
</p>
</div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw">plot</span>(butterflies[[<span class="dv">2</span>]])</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-87-2.png" alt="_Raw images of our butterflies_" width="384"><p class="caption">
<em>Raw images of our butterflies</em>
</p>
</div>
<p>The <code>summary</code> function offers some summary information about images or lists of images as we might expect. If we specify <code>plot = TRUE</code> however, the function instead plots the image. When such images have been color-classified this also plots the images’ colour pallete alongside (see below). This is an extremely useful diagnotistic tool when classifying images, as it allows us to see how well the classification algorithm has performed in clustering color pattern elements into discrete color categories. As with all plots, the function takes all standard plot arguments (see <code>?par</code>), such as custom colors, which again can be diagnostically useful.</p>
</div>
</div>
<div id="processing-image-data" class="section level1">
<h1 class="hasAnchor">
<a href="#processing-image-data" class="anchor"></a>Processing Image Data</h1>
<div id="overview-2" class="section level2">
<h2 class="hasAnchor">
<a href="#overview-2" class="anchor"></a>Overview</h2>
<p>Images often require some post-capture processing, depending on the intended use, and <code>pavo</code> offers some useful options via <code>procimg</code>. The functionality of <code>procimg</code> is currently limited to only that which is closely relevant to the analyses currently implemented, as we assume any major processing and quality-checking (e.g. image rotation and color correction) is undertaken by the user beforehand. However, should users with to keep their image processing within the R ecosystem, there now exist several excellent image-processing packages such as <code>imager</code> and <code>magick</code>, which <code>pavo</code> can seamlessly work with. Indeed, the functions <code>rimg2cimg</code> and <code>cimg2rimg</code> convert images from <code>pavo</code> preferred structure to that used by <code>imager</code> (and vice-versa), which simplifies the transitions between these packages.</p>
</div>
<div id="setting-scales-and-defining-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-scales-and-defining-objects" class="anchor"></a>Setting Scales and Defining Objects</h2>
<p>The functionality of <code>procimg</code> is currently centered on (1) rotating and resizing images, (2) setting an image scale, and (3) distinguishing the focal object from its background. Rotating an image simply requires inputting an angle, in degrees, by which the image is rotated about its centre, which resizing requires a scaling factor by which the size of image(s) are to be decreased or increased. Functions (2) and (3), in contrast, are both interactive, meaning that we are presented with the focal image and must select points on it using the mouse (either a line, when setting a scale, or a polygon when identifying the focus). If setting a scale, we specify a scale in our preferred units via <code>scaledist</code>, and then click the endpoints of the scale within the image (which could be a ‘formal’ scale, or simply the length of a wing or another known reference object). This information, as usual, is attached to the image as an attribute.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1">butterflies &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procimg.html">procimg</a></span>(butterflies, <span class="dt">scaledist =</span> <span class="dv">100</span>)</a></code></pre></div>
<p>Distinguishing a focal object from its background is important in cases where we are analysing a broader visual scene, particularly when the background is highly heterogeneous, such as an animal in nature, and cannot be classified into a homogeneous block and identified more simply (see below). To define the object and background we specify <code>outline = TRUE</code>, which will result in being asked to click around the outline of the focal object in each image, which is then converted to a polygon — the xy coordinates of which are saved as an attribute. It is often useful to slightly smooth the resulting polygon, which can be done with Chaikin’s corner-cuting algorithm by specifying a number of <code>refinements</code>. Chaikin’s algorithm works by iteratively replacing every point by two new points 1/4 of the way to the next. The argument <code>iterations</code> specifies the number of corner cutting iterations to apply, and the default value of 1 offers a subtle smoothing effect.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1">butterflies &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procimg.html">procimg</a></span>(butterflies, <span class="dt">outline =</span> <span class="ot">TRUE</span>, <span class="dt">iterations =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>All of these options can be simultaneously specified in a single call to <code>procimg</code>, and the <code>pavo 2.0</code> publication offers a useful example of such processing, since the more involved features are difficult illustrate here due to their interactive nature.</p>
</div>
<div id="image-color-classification" class="section level2">
<h2 class="hasAnchor">
<a href="#image-color-classification" class="anchor"></a>Image Color-Classification</h2>
<p>The segmentation of RGB images into discrete color-classes is an essential step on the road to several analyses, and this is carried out in <code>pavo</code> via <code>classify</code>. The function currently implements k-means clustering which, although an ‘unsupervised’ methods of image segmentation, offers some flexibility in the way in which it is carried out. In the simplest case, we can specify an image or image(s) as well as the number of discrete colors in each (an important step to be closely considered beforehand beforehand, often through visual modelling to estimate the number of discriminable colors), and allow the k-means clustering algorithm to do its work. Since we have two images, with (arguably) four and three colours each, including the white background, we can specify this information using <code>kcols</code>, before visualising the results with <code>summary</code>. The <code>summary</code> function, with <code>plot = TRUE</code>, is also particularly useful for understanding the colour-class labels, or ID’s, assigned to each colour, as well as visualising the accuracy of the classification process, which may be enhanced by specifying strongly-contrasting ‘false’ colours for plotting through the <code>col</code> argument.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">kcols =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>## Image classification in progress...</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1"><span class="co"># Note that we could simply feed the list of images to summary, rather than </span></a>
<a class="sourceLine" id="cb183-2" data-line-number="2"><span class="co"># specifying individual images, and they would progress automatically </span></a>
<a class="sourceLine" id="cb183-3" data-line-number="3"><span class="co"># with user input.</span></a>
<a class="sourceLine" id="cb183-4" data-line-number="4"></a>
<a class="sourceLine" id="cb183-5" data-line-number="5"><span class="kw">summary</span>(butterflies_class[[<span class="dv">2</span>]], <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="pavo_files/figure-html/unnamed-chunk-91-1.png" alt="_The k-means classified images of our butterflies, along with their identified color palettes_" width="480"><p class="caption">
<em>The k-means classified images of our butterflies, along with their identified color palettes</em>
</p>
</div>
<p>There are other options available, which may be of particular use when the classification process is not producing the results that might be expected <em>a priori</em>. If analysing similar images with homologous colour patterns (e.g. individuals within a species), we could specify a single ‘reference’ image in a list to be initially classified, using <code>refID</code>, with the RGB centers identified in this reference image used as pre-specified cluster centres in subsequent images. This helps to ensure that homologous pattern elements are reliably identified and classified between images. The <code>classify</code> function also offers an interactive option, via <code>interactive = TRUE</code>, wherein we can interactively click on representative colors within an image (or images individually), with the RGB values then used as cluster centers. This is particularly useful when images are being erroneously classified, since the standard k-means process randomly selects initial centers and so may (by chance) miss smaller patches, or confuse similar colors. By specifying the intial RGB centers interactively, it can be easier for the process to distinguish or ‘pull apart’ colours in such circumstances. Ultimately, there are several combinations of options availble during classification, which are also documented in the help file. For our butterflies, for example, we could use any of the following (though some would be very ill-advised):</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="co"># Automatic classification.</span></a>
<a class="sourceLine" id="cb184-2" data-line-number="2">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">kcols =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb184-3" data-line-number="3"></a>
<a class="sourceLine" id="cb184-4" data-line-number="4"><span class="co"># Automatic classification using a reference image</span></a>
<a class="sourceLine" id="cb184-5" data-line-number="5">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">kcols =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb184-6" data-line-number="6"></a>
<a class="sourceLine" id="cb184-7" data-line-number="7"><span class="co"># Classification using interactively-specified centres for each image, with no </span></a>
<a class="sourceLine" id="cb184-8" data-line-number="8"><span class="co"># need to specify kcols (since it will be inferred from the numbers of colours selected)</span></a>
<a class="sourceLine" id="cb184-9" data-line-number="9">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">interactive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb184-10" data-line-number="10"></a>
<a class="sourceLine" id="cb184-11" data-line-number="11"><span class="co"># Classification using interactively-specified centres for the single reference image</span></a>
<a class="sourceLine" id="cb184-12" data-line-number="12"><span class="co"># (here, the first in the list).</span></a>
<a class="sourceLine" id="cb184-13" data-line-number="13">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">refID =</span> <span class="dv">1</span>, <span class="dt">interactive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
</div>
<div id="analyzing-image-data" class="section level1">
<h1 class="hasAnchor">
<a href="#analyzing-image-data" class="anchor"></a>Analyzing Image Data</h1>
<div id="adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts" class="section level2">
<h2 class="hasAnchor">
<a href="#adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts" class="anchor"></a>Adjacency and Boundary Strength Analyses, and Overall Pattern Contrasts</h2>
<p>The adjacency (Endler 2012) and boundary strength (Endler et al. 2018) analyses offer a powerful method for quantiying various features of color pattern geometry. Briefly, the process entails classifying the pixels of images into a number of discrete colour classes, using <code>classify</code> as described above, before sampling the now-classified image with an evenly spaced grid of user-specified density. The column-wise and row-wise colour-class transitions between adjacent points are then tallied, and from this a suite of summary statistics on pattern structure — from simple colour proportions, through to colour diversity and pattern complexity — are estimated. If the colour ‘distance’ between adjacent colour classes is known, such as might be estimated using spectral data for receptor-noise modelling via <code>vismodel</code> and <code>coldist</code>, then this can also be incorporated to derive several measures of the salience of patch boundaries (Endler et al. 2018). Finally, if estimates of hue, saturation, and/or brightness are known for each discrete colour in a pattern, then these can be included through the <code>hsl</code> argument for general, area-weighted measures of overall pattern contrast (Endler &amp; Mielke 2005).</p>
<p>In <code>pavo</code>, this is all carried out through the <code>adjacent</code> function, which takes several arguments that should be well understood. For our butterflies, we’ll specify a full x-dimension scale of 200 mm using <code>xscale</code> (which could be ignored if we specify scales using <code>procimg</code>), and a sampling density of 200, for a 200 x 200 grid. Since the white background of our images is fake and of no interest, we will also exclude it by specifying the color-class ID that corresponds to it (for more complex backgrounds, we could instead use <code>procimg</code>, as above, and ignore this argument).</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">butterflies_adj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/adjacent.html">adjacent</a></span>(butterflies_class, <span class="dt">xscale =</span> <span class="dv">200</span>, <span class="dt">xpts =</span> <span class="dv">200</span>, <span class="dt">bkgID =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb185-2" data-line-number="2"></a>
<a class="sourceLine" id="cb185-3" data-line-number="3"><span class="kw">head</span>(butterflies_adj)</a></code></pre></div>
<pre><code>##             k     N n_off       p_1       p_2        p_3       p_4
## h_melpomene 4 54064  5111 0.0406250 0.3408824 0.03511029 0.5833824
## papilio     3 63241  4387 0.5607233 0.2002201 0.23905660        NA
##                  q_1_1       q_1_2     q_2_2       q_1_3      q_2_3
## h_melpomene 0.02683856 0.018256141 0.3071175 0.009821693 0.03486608
## papilio     0.54839424 0.007163075 0.1730523 0.012839772 0.04936671
##                   q_3_3      q_2_4      q_3_4    q_4_4     t_1_2     t_1_3
## h_melpomene 0.006510802 0.01864457 0.01294762 0.564997 0.1931129 0.1038936
## papilio     0.209183915         NA         NA       NA 0.1032596 0.1850923
##                 t_2_3     t_2_4     t_3_4          m        m_r        m_c
## h_melpomene 0.3688124 0.1972217 0.1369595 0.09395221 0.08779412 0.10011029
## papilio     0.7116481        NA        NA 0.06894056 0.07836478 0.05951633
##                     A       Sc       St        Jc        Jt         B
## h_melpomene 0.8769739 2.176663 4.136277 0.5441657 0.6893795 0.9446292
## papilio     1.3166937 2.429267 1.813682 0.8097558 0.6045606 0.8536585
##                    Rt Rab m_dS s_dS cv_dS m_dL s_dL cv_dL m_hue s_hue
## h_melpomene 0.5905111   1   NA   NA    NA   NA   NA    NA    NA    NA
## papilio     0.5513647   1   NA   NA    NA   NA   NA    NA    NA    NA
##             var_hue m_sat s_sat cv_sat m_lum s_lum cv_lum
## h_melpomene      NA    NA    NA     NA    NA    NA     NA
## papilio          NA    NA    NA     NA    NA    NA     NA</code></pre>
<p>The output is a suite of statistics describing color pattern structure and geometry in a tidy data frame that, since we fed it a list of images, contains one row for each of our samples. Note that some of the output is <code>NA</code>, which might occur when the focal statistic simply makes no sense for the image in question (such as the transition frequency between color categories 3 and 4, for an image that contains only 3 color categories). Others may result when we do not give <code>adjacent</code> enough information, such as the color-distances required to calculate the boundary-strength statistics, or the colormetrics required for overal pattern contrast. If we do give the function this information, we can see that those final variables now contain sensible output.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1"><span class="co"># Create a fake matrix of pairwise color- and luminance distances between all </span></a>
<a class="sourceLine" id="cb187-2" data-line-number="2"><span class="co"># color patten elements, as might be attained through visual modelling of spectral data.</span></a>
<a class="sourceLine" id="cb187-3" data-line-number="3">distances &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">c1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb187-4" data-line-number="4">                        <span class="dt">c2 =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb187-5" data-line-number="5">                        <span class="dt">dS =</span> <span class="kw">c</span>(<span class="fl">10.6</span>, <span class="fl">5.1</span>, <span class="fl">4.4</span>),</a>
<a class="sourceLine" id="cb187-6" data-line-number="6">                        <span class="dt">dL =</span> <span class="kw">c</span>(<span class="fl">1.1</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>))</a>
<a class="sourceLine" id="cb187-7" data-line-number="7"></a>
<a class="sourceLine" id="cb187-8" data-line-number="8"><span class="co"># Take a look</span></a>
<a class="sourceLine" id="cb187-9" data-line-number="9">distances</a></code></pre></div>
<pre><code>##   c1 c2   dS  dL
## 1  1  2 10.6 1.1
## 2  1  3  5.1 2.5
## 3  2  3  4.4 3.2</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1"><span class="co"># And our fake hue angles (in radians), saturation, and luminance values, for each</span></a>
<a class="sourceLine" id="cb189-2" data-line-number="2"><span class="co"># color pattern element</span></a>
<a class="sourceLine" id="cb189-3" data-line-number="3">hsl_vals &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">patch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb189-4" data-line-number="4">                       <span class="dt">hue =</span> <span class="kw">c</span>(<span class="fl">1.2</span>, <span class="fl">2.2</span>, <span class="fl">1.6</span>),</a>
<a class="sourceLine" id="cb189-5" data-line-number="5">                       <span class="dt">lum =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb189-6" data-line-number="6">                       <span class="dt">sat =</span> <span class="kw">c</span>(<span class="fl">3.5</span>, <span class="fl">1.1</span>, <span class="fl">6.3</span>))</a>
<a class="sourceLine" id="cb189-7" data-line-number="7"></a>
<a class="sourceLine" id="cb189-8" data-line-number="8"><span class="co"># Take a look</span></a>
<a class="sourceLine" id="cb189-9" data-line-number="9">hsl_vals</a></code></pre></div>
<pre><code>##   patch hue lum sat
## 1     1 1.2  10 3.5
## 2     2 2.2   5 1.1
## 3     3 1.6   7 6.3</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1"><span class="co"># Now feed this information into the adjacency analysis using the less-colorful </span></a>
<a class="sourceLine" id="cb191-2" data-line-number="2"><span class="co"># of our two images, for convenience (though this could be readily extended to </span></a>
<a class="sourceLine" id="cb191-3" data-line-number="3"><span class="co"># include a list of images along with a list of distances and hsl values)</span></a>
<a class="sourceLine" id="cb191-4" data-line-number="4"><span class="kw"><a href="../reference/adjacent.html">adjacent</a></span>(butterflies_class[[<span class="dv">2</span>]], <span class="dt">xscale =</span> <span class="dv">200</span>, <span class="dt">xpts =</span> <span class="dv">200</span>, <span class="dt">bkgID =</span> <span class="dv">1</span>, <span class="dt">coldists =</span> distances, <span class="dt">hsl =</span> hsl_vals)</a></code></pre></div>
<pre><code>##         k     N n_off       p_1       p_2       p_3     q_1_1       q_1_2
## papilio 3 63241  4387 0.5607233 0.2002201 0.2390566 0.5483942 0.007163075
##             q_2_2      q_1_3      q_2_3     q_3_3     t_1_2     t_1_3
## papilio 0.1730523 0.01283977 0.04936671 0.2091839 0.1032596 0.1850923
##             t_2_3          m        m_r        m_c        A       Sc
## papilio 0.7116481 0.06894056 0.07836478 0.05951633 1.316694 2.429267
##               St        Jc        Jt         B        Rt Rab     m_dS
## papilio 1.813682 0.8097558 0.6045606 0.8536585 0.5513647   1 5.169774
##             s_dS     cv_dS    m_dL      s_dL     cv_dL    m_hue     s_hue
## papilio 2.780084 0.5377573 2.85359 0.9745272 0.3415092 1.663715 0.4154308
##           var_hue   m_sat    s_sat    cv_sat   m_lum   s_lum  cv_lum
## papilio 0.0826731 3.68883 2.255009 0.6113073 8.28173 2.67326 0.32279</code></pre>
</div>
</div>
<div id="classes-and-attributes" class="section level1">
<h1 class="hasAnchor">
<a href="#classes-and-attributes" class="anchor"></a>Classes and Attributes</h1>
<p>To enable the comprehensive workflow of <code>pavo</code>, we’ve implemented an expanded class system. Spectra will be of class <code>rspec</code> as long as we use one of <code>pavo</code>’s spectral import or processing funcitons, or explicitly convert an object using <code>as.rspec</code>. Similary, images will be of calss <code>rimg</code> when imported via <code>getimg</code>, or if converted using <code>as.rimg</code>. The results of <code>vismodel</code> are objects of class <code>vismodel</code> and the results of <code>colspace</code> are, unsurprisingly, objects of class <code>colspace</code>. Most of these classes inherit from <code>data.frame</code>, and contain a suite of attributes that describe the object’s characteristics (e.g. options used in visual modelling such as the selected visual system and illuminant, and properties of the modelled colorspace). These are easily viewed using the <code>summary</code> function (on any <code>rspec</code>, <code>rimg</code>, <code>vismodel</code>, or <code>colspace</code> object), which will return the attributes and summary data (where appropriate) in a readable format.</p>
</div>
<div id="final-thoughts" class="section level1">
<h1 class="hasAnchor">
<a href="#final-thoughts" class="anchor"></a>Final Thoughts</h1>
<p>We hope to have demonstrated the flexibility of <code>pavo</code> when it comes to importing, processing, exploring, visualizing and analyzing spectral and spatial data. Our aim was to provide a cohesive, start-to-finish workflow of color pattern analysis with <code>R</code>, without the need for additional software. Though our examples have broadly focused on bird reflectance data and visual models, <code>pavo</code> should be easily extended to any taxon of interest, including the possibility of modeling sensitivity curves through the <code>sensmodel</code> function.</p>
<p>For suggestions, assistance and/or bug reports, we suggest getting in touch via ‘gitter’ at <a href="https://gitter.im/r-pavo/help" class="uri">https://gitter.im/r-pavo/help</a>, which is essentially a public chat room for all things pavo. If you have a bug to report, we’d appreciate it if you could also include a reproducible example when possible. Users familiar with git may prefer to open an issue on the project’s <a href="https://github.com/rmaia/pavo">github page</a>, or to make a pull-request directly.</p>
</div>
<div id="citation-of-methods-implemented-in-pavo" class="section level1">
<h1 class="hasAnchor">
<a href="#citation-of-methods-implemented-in-pavo" class="anchor"></a>Citation of methods implemented in <code>pavo</code>
</h1>
<p>Most of the methods implemented in <code>pavo</code> have been thoroughly described in their original publications, to which users should refer for details and interpretation. For reflectance shape variables (“objective colourimetrics”) and their particular relation to signal production and perception, see Andersson &amp; Prager (2006) and Montgomerie (2006). Visual models based on photon catches and receptor noise are detailed in Vorobyev &amp; Osorio (1998) and Vorobyev et al. (1998), and photoreceptor sensitivity curve estimation in Govardovskii (2000) and Hart &amp; Vorobyev (2005). For tetrahedral colourspace model implementations and variable calculations, see Endler &amp; Mielke (2005) and Stoddard &amp; Prum (2008), and for colour volume overlap see Stoddard &amp; Prum (2008) and Stoddard &amp; Stevens (2011). Adjacency and boundary strength analyses are described in Endler (2012) and Endler et al. (2018), while overall pattern contrast is detailed in Endler &amp; Mielke (2005). Users of the functions that apply these methods must cite the original sources as appropriate, along with <code>pavo</code> itself.</p>
</div>
<div id="acknowledgments" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgments" class="anchor"></a>Acknowledgments</h1>
<p>We would like to thank Matthew D. Shawkey and Stephanie M. Doucet for insights and support, and Jarrod D. Hadfield and Mary Caswell Stoddard for sharing code that helped us develop some of <code>pavo</code>’s capabilities.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Andersson S. and Prager M. Quantifying colors. In K. J. Mcgraw and G. E. Hill, editors, <em>Bird Coloration</em> Vol. I, pages 41–89. Harvard Univ. Press Cambridge, MA, 2006.</p>
<p>Backhaus W. (1991). Color opponent coding in the visual system of the honeybee. <em>Vision Research</em>, 31, 1381-1397.</p>
<p>Cuthill I. C. , Bennett A. T. D. , Partridge J. C. , and Maier E. J. Plumage reflectance and the objective assessment of avian sexual dichromatism. <em>The American Naturalist</em>, 153(2):183–200, 1999.</p>
<p>Chittka L. (1992). The colour hexagon: a chromaticity diagram based on photoreceptor excitations as a generalized representation of colour opponency. <em>Journal of Comparative Physiology A</em>, 170(5), 533-543.</p>
<p>Chittka L, Shmida A, Troje N, Menzel R. (1994). Ultraviolet as a component of flower reflections, and the colour perception of Hymenoptera. <em>Vision research</em>, 34(11), 1489-1508.</p>
<p>CIE (2006). Fundamental chromaticity diagram with physiological axes. Parts 1 and 2. Technical Report 170-1. <em>Vienna: Central Bureau of the Commission Internationale de l Eclairage.</em></p>
<p>Endler J. A. On the measurement and classification of colour in studies of animal colour patterns. <em>Biological Journal Of The Linnean Society</em>, 41(4):315–352, 1990.</p>
<p>Endler J. A. and Mielke P. W., Comparing entire colour patterns as birds see them. <em>Biological Journal Of The Linnean Society</em>, 86(4):405–431, 2005.</p>
<p>Endler, J. A. (2012). A framework for analysing colour pattern geometry: adjacent colours. <em>Biological Journal Of The Linnean Society</em>, 86(4), 405-431.</p>
<p>Endler, J. A., Cole G., Kranz A. (2018). Boundary Strength Analysis: Combining color pattern geometry and coloured patch visual properties for use in predicting behaviour and fitness. <em>bioRxiv</em>.</p>
<p>Goldsmith T. H. Optimization, constraint, and history in the evolution of eyes. <em>Quarterly Review Of Biology</em>, 65(3):281–322, 1990.</p>
<p>Gomez D. AVICOL, a program to analyse spectrometric data., 2006. Last update January 2012.</p>
<p>Govardovskii V. I., Fyhrquist N., Reuter T., Kuzmin D. G., and Donner K. In search of the visual pigment template. <em>Visual Neuroscience</em>, 17(4):509–528, 2000.</p>
<p>Hart N.S., and Vorobyev M. Modelling oil droplet absorption spectra and spectral sensitivities of bird cone photoreceptors. <em>Journal of Comparative Physiology A: Neuroethology, Sensory, Neural, and Behavioral Physiology</em>, 191(4):381–392, 2005.</p>
<p>Maia, R., White, T. E., (2018) Comparing colors using visual models. <em>Behavioral Ecology</em>, ary017 doi: 10.1093/beheco/ary017.</p>
<p>Montgomerie R. Analyzing colors. In K. J. Mcgraw and G. E. Hill, editors, <em>Bird Coloration</em> Vol. I, pages 90–147. Harvard Univ. Press Cambridge, MA, 2006.</p>
<p>Siddiqi A., Cronin T. W., Loew E. R., Vorobyev M., and Summers K. Interspecific and intraspecific views of color signals in the strawberry poison frog Dendrobates pumilio. <em>Journal of Experimental Biology</em>, 207(14):2471–2485, 2004.</p>
<p>Smith T, Guild J. (1932) The CIE colorimetric standards and their use. <em>Transactions of the Optical Society</em>, 33(3), 73-134.</p>
<p>Stockman, A., &amp; Sharpe, L. T. (2000). Spectral sensitivities of the middle- and long-wavelength sensitive cones derived from measurements in observers of known genotype. <em>Vision Research</em>, 40, 1711-1737.</p>
<p>Stoddard M. C., and Prum R. O. Evolution of avian plumage color in a tetrahedral color space: a phylogenetic analysis of new world buntings. <em>The American Naturalist</em>, 171(6):755–776, 2008.</p>
<p>Stoddard, M. C. and Stevens M. Avian vision and the evolution of egg color mimicry in the common cuckoo. <em>Evolution</em>, 65(7):2004–2013, 2011.</p>
<p>Troje N. (1993). Spectral categories in the learning behaviour of blowflies. <em>Zeitschrift fur Naturforschung C</em>, 48, 96-96.</p>
<p>Vorobyev M. and Osorio D. Receptor noise as a determinant of colour thresholds. <em>Proceedings Of The Royal Society Of London Series B-Biological Sciences</em>, 265(1394):351– 358, 1998.</p>
<p>Vorobyev M., Osorio D., Bennett A. T. D. , Marshall N. J., and Cuthil I. C. Tetra- chromacy, oil droplets and bird plumage colours. <em>Journal Of Comparative Physiology A-Neuroethology Sensory Neural And Behavioral Physiology</em>, 183(5):621–633, 1998.</p>
<p>Westland S, Ripamonti C, Cheung V. (2012). <em>Computational colour science using MATLAB</em>. John Wiley &amp; Sons.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#organizing-spectral-data">Organizing Spectral Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#spectral-dataset-description">Spectral Dataset Description</a></li>
      <li><a href="#importing">Importing</a></li>
      <li><a href="#subsetting-and-merging-spectral-data">Subsetting and Merging Spectral Data</a></li>
      </ul>
</li>
      <li>
<a href="#processing-spectral-data">Processing Spectral Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#averaging-spectra">Averaging Spectra</a></li>
      <li><a href="#normalizing-and-smoothing-spectra">Normalizing and Smoothing Spectra</a></li>
      <li><a href="#binning-and-pca-analysis-of-spectral-shape">Binning and PCA Analysis of Spectral Shape</a></li>
      <li><a href="#dealing-with-negative-values-in-spectra">Dealing With Negative Values in Spectra</a></li>
      </ul>
</li>
      <li>
<a href="#visualizing-spectral-data">Visualizing Spectral Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-plot-function-options">The <code>plot</code> Function Options</a></li>
      <li><a href="#the-aggplot-function">The <code>aggplot</code> Function</a></li>
      </ul>
</li>
      <li>
<a href="#analyzing-spectral-data">Analyzing Spectral Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#spectral-shape-analysis">Spectral Shape Analysis</a></li>
      <li><a href="#visual-modelling">Visual Modelling</a></li>
      </ul>
</li>
      <li><a href="#organizing-spatial-image-data">Organizing Spatial (image) Data</a></li>
      <li>
<a href="#visualising-image-data">Visualising Image Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-plot-and-summary-functions">The <code>plot</code> and <code>summary</code> Functions</a></li>
      </ul>
</li>
      <li>
<a href="#processing-image-data">Processing Image Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#overview-2">Overview</a></li>
      <li><a href="#setting-scales-and-defining-objects">Setting Scales and Defining Objects</a></li>
      <li><a href="#image-color-classification">Image Color-Classification</a></li>
      </ul>
</li>
      <li>
<a href="#analyzing-image-data">Analyzing Image Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts">Adjacency and Boundary Strength Analyses, and Overall Pattern Contrasts</a></li>
      </ul>
</li>
      <li><a href="#classes-and-attributes">Classes and Attributes</a></li>
      <li><a href="#final-thoughts">Final Thoughts</a></li>
      <li><a href="#citation-of-methods-implemented-in-pavo">Citation of methods implemented in <code>pavo</code></a></li>
      <li><a href="#acknowledgments">Acknowledgments</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Rafael Maia, Thomas White, Hugo Gruson, Chad Eliason, Pierre-Paul Bitton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
